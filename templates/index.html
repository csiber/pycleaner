<!DOCTYPE html>
<html lang="hu" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>PyCleaner v3.0</title>
  <link rel="icon" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="/static/favicon.png">
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=IBM+Plex+Mono:wght@300;400;600&display=swap" rel="stylesheet">
  <style>
    /* â”€â”€â”€ THEME VARIABLES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    [data-theme="dark"] {
      --bg:      #080a0e;  --surface:  #0d1117;  --surface2: #131b24;
      --border:  #1a2535;  --border2:  #243040;
      --text:    #c0d0e0;  --text2:    #4a6070;   --text3:    #324050;
      --accent:  #00c8f0;  --accent2:  #ff6b35;   --accent3:  #5eff6e;
      --danger:  #ff3e5e;  --warn:     #ffb830;
      --scrollbar: #1a2535;
    }
    [data-theme="light"] {
      --bg:      #f0f4f8;  --surface:  #ffffff;   --surface2: #e8eef4;
      --border:  #d0dce8;  --border2:  #b8cad8;
      --text:    #1a2535;  --text2:    #6080a0;   --text3:    #90aabf;
      --accent:  #0095c8;  --accent2:  #e05020;   --accent3:  #18a830;
      --danger:  #d02040;  --warn:     #d08010;
      --scrollbar: #d0dce8;
    }

    * { box-sizing:border-box; margin:0; padding:0; transition: background-color 0.3s, color 0.2s, border-color 0.2s; }

    body {
      font-family: 'IBM Plex Mono', monospace;
      background: var(--bg); color: var(--text);
      min-height: 100vh; overflow-x: hidden;
    }

    [data-theme="dark"] body::before {
      content:''; position:fixed; inset:0;
      background-image: linear-gradient(rgba(0,200,240,.018) 1px,transparent 1px),
                        linear-gradient(90deg,rgba(0,200,240,.018) 1px,transparent 1px);
      background-size: 44px 44px; pointer-events:none; z-index:0;
    }

    .app {
      position:relative; z-index:1;
      display:grid; grid-template-columns:220px 1fr; grid-template-rows:58px 1fr;
      min-height:100vh;
    }

    /* â”€â”€â”€ HEADER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    header {
      grid-column:1/-1; display:flex; align-items:center; gap:12px;
      padding:0 18px; background:rgba(8,10,14,.97);
      border-bottom:1px solid var(--border);
      backdrop-filter:blur(12px); position:sticky; top:0; z-index:200;
    }
    [data-theme="light"] header { background:rgba(240,244,248,.97); }

    .logo {
      font-family:'Orbitron',sans-serif; font-size:17px; font-weight:900;
      color:var(--accent); letter-spacing:3px;
      text-shadow: 0 0 18px rgba(0,200,240,.35);
    }
    .logo span { color:var(--accent2); }

    .ver { font-size:8px; background:rgba(0,200,240,.1); color:var(--accent);
           padding:2px 6px; border:1px solid rgba(0,200,240,.25); border-radius:2px; letter-spacing:1.5px; }

    .hdr-right { margin-left:auto; display:flex; align-items:center; gap:8px; }

    .theme-btn {
      background:var(--surface); border:1px solid var(--border); color:var(--text2);
      padding:5px 10px; border-radius:3px; cursor:pointer; font-size:14px;
      transition:all .15s;
    }
    .theme-btn:hover { border-color:var(--accent); color:var(--accent); }

    .profile-sel {
      background:var(--surface); border:1px solid var(--border); color:var(--text);
      font-family:'IBM Plex Mono',monospace; font-size:10px; padding:5px 8px;
      border-radius:3px; cursor:pointer;
    }

    .sys-badge {
      font-size:10px; color:var(--text2); padding:4px 10px;
      border:1px solid var(--border); border-radius:2px; background:var(--surface);
    }

    /* â”€â”€â”€ SIDEBAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    nav {
      background:var(--surface); border-right:1px solid var(--border);
      padding:14px 0; display:flex; flex-direction:column; overflow-y:auto;
    }

    .nav-sec {
      padding:10px 14px 4px; font-size:8px; letter-spacing:2.5px;
      color:var(--text3); text-transform:uppercase;
    }

    .nav-item {
      display:flex; align-items:center; gap:10px; padding:9px 16px;
      cursor:pointer; border-left:3px solid transparent;
      font-size:11px; color:var(--text2); transition:all .12s; user-select:none;
    }
    .nav-item:hover { background:rgba(0,200,240,.05); color:var(--text); }
    .nav-item.active { background:rgba(0,200,240,.07); border-left-color:var(--accent); color:var(--accent); }

    .nav-icon { font-size:14px; width:17px; text-align:center; }

    .nav-pill {
      margin-left:auto; font-size:8px; padding:1px 5px; border-radius:2px;
      background:var(--surface2); border:1px solid var(--border2); color:var(--text2); white-space:nowrap;
    }
    .nav-pill.warn { border-color:var(--warn); color:var(--warn); }
    .nav-pill.ok   { border-color:var(--accent3); color:var(--accent3); }
    .nav-pill.hot  { border-color:var(--danger); color:var(--danger); }

    .nav-div { height:1px; background:var(--border); margin:7px 12px; }

    /* â”€â”€â”€ MAIN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    main { padding:22px; overflow-y:auto; background:var(--bg); }

    .page { display:none; animation:fadeIn .18s; }
    .page.active { display:block; }
    @keyframes fadeIn { from{opacity:0;transform:translateY(4px)} to{opacity:1;transform:none} }

    .page-title { font-family:'Orbitron',sans-serif; font-size:18px; font-weight:700; color:var(--text); margin-bottom:3px; }
    .page-sub   { font-size:10px; color:var(--text2); margin-bottom:20px; letter-spacing:.8px; }

    /* â”€â”€â”€ GRID / CARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .grid-3 { display:grid; grid-template-columns:repeat(3,1fr); gap:12px; margin-bottom:16px; }
    .grid-2 { display:grid; grid-template-columns:repeat(2,1fr); gap:12px; }

    .card {
      background:var(--surface); border:1px solid var(--border); border-radius:4px; padding:16px;
      transition:border-color .2s;
    }
    .card:hover { border-color:var(--border2); }
    .card-hdr { display:flex; align-items:center; justify-content:space-between; margin-bottom:9px; }
    .card-lbl { font-size:9px; letter-spacing:1.5px; color:var(--text2); text-transform:uppercase; }
    .card-ico { font-size:17px; }
    .stat { font-family:'Orbitron',sans-serif; font-size:20px; font-weight:700; color:var(--accent); }
    .stat-sub { font-size:9px; color:var(--text2); margin-top:3px; }

    /* â”€â”€â”€ CLEANER ITEMS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .c-items { display:flex; flex-direction:column; gap:8px; margin-bottom:14px; }

    .c-item {
      background:var(--surface); border:1px solid var(--border); border-radius:4px;
      padding:12px 16px; display:flex; align-items:center; gap:12px;
      cursor:pointer; transition:all .12s;
    }
    .c-item:hover    { border-color:var(--border2); background:var(--surface2); }
    .c-item.selected { border-color:var(--accent); background:rgba(0,200,240,.05); }

    .chk {
      width:15px; height:15px; border:2px solid var(--border2); border-radius:2px;
      display:flex; align-items:center; justify-content:center; flex-shrink:0;
      font-size:9px; transition:all .12s;
    }
    .c-item.selected .chk { border-color:var(--accent); background:var(--accent); color:#000; }

    .ci-info { flex:1; }
    .ci-name { font-size:11px; font-weight:600; color:var(--text); margin-bottom:2px; }
    .ci-desc { font-size:9px; color:var(--text2); }
    .ci-size { text-align:right; flex-shrink:0; min-width:70px; }
    .ci-val  { font-family:'Orbitron',sans-serif; font-size:12px; color:var(--accent2); }
    .ci-fc   { font-size:9px; color:var(--text2); margin-top:1px; }
    .ci-scan { font-size:9px; color:var(--text2); animation:blink 1s infinite; }
    @keyframes blink { 0%,100%{opacity:1} 50%{opacity:.3} }

    /* â”€â”€â”€ ACTION BAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .action-bar {
      display:flex; flex-wrap:wrap; align-items:center; gap:8px;
      padding:14px 16px; background:var(--surface);
      border:1px solid var(--border); border-radius:4px; margin-bottom:12px;
    }
    .age-filter { display:flex; align-items:center; gap:6px; }
    .age-filter label { font-size:9px; color:var(--text2); }
    select.styled, input.styled {
      background:var(--surface2); border:1px solid var(--border2); color:var(--text);
      font-family:'IBM Plex Mono',monospace; font-size:10px; padding:5px 8px;
      border-radius:2px; cursor:pointer;
    }
    select.styled:focus, input.styled:focus { outline:none; border-color:var(--accent); }
    .action-total { margin-left:auto; text-align:right; }
    .total-lbl { font-size:8px; color:var(--text2); letter-spacing:1px; text-transform:uppercase; }
    .total-val { font-family:'Orbitron',sans-serif; font-size:15px; color:var(--accent2); }

    /* â”€â”€â”€ BUTTONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .btn {
      display:inline-flex; align-items:center; gap:5px;
      padding:7px 15px; border:none; border-radius:3px;
      font-family:'IBM Plex Mono',monospace; font-size:10px; font-weight:600;
      letter-spacing:.8px; cursor:pointer; transition:all .12s;
      text-transform:uppercase; white-space:nowrap; text-decoration:none;
    }
    .btn-p { background:var(--accent);  color:#000; }
    .btn-p:hover { filter:brightness(1.1); box-shadow:0 0 16px rgba(0,200,240,.35); }
    .btn-d { background:var(--danger); color:#fff; }
    .btn-d:hover { filter:brightness(1.1); box-shadow:0 0 16px rgba(255,62,94,.35); }
    .btn-w { background:var(--warn); color:#000; }
    .btn-w:hover { filter:brightness(1.1); }
    .btn-s { background:transparent; color:var(--text2); border:1px solid var(--border2); }
    .btn-s:hover { border-color:var(--text2); color:var(--text); }
    .btn-g { background:var(--accent3); color:#000; }
    .btn-g:hover { filter:brightness(1.1); }
    .btn:disabled { opacity:.35; cursor:not-allowed; filter:none!important; box-shadow:none!important; }
    .btn-sm { padding:5px 10px; font-size:9px; }

    /* â”€â”€â”€ PROGRESS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .prog-wrap { display:none; background:var(--surface); border:1px solid var(--border); border-radius:4px; padding:14px; margin-bottom:12px; }
    .prog-wrap.visible { display:block; }
    .prog-lbl { font-size:10px; color:var(--text2); margin-bottom:7px; }
    .prog-bg  { height:3px; background:var(--border); border-radius:2px; overflow:hidden; }
    .prog-fill { height:100%; background:linear-gradient(90deg,var(--accent),var(--accent2)); border-radius:2px; transition:width .3s; }
    .prog-fill.ind { width:35%; animation:slide 1s linear infinite; }
    @keyframes slide { 0%{transform:translateX(-120%)} 100%{transform:translateX(380%)} }

    /* â”€â”€â”€ CLEAN ANIMATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #cleanAnim {
      display:none; position:fixed; inset:0; z-index:9999;
      background:rgba(8,10,14,.92); align-items:center; justify-content:center;
      flex-direction:column; gap:20px;
    }
    #cleanAnim.visible { display:flex; }
    .broom-wrap { font-size:64px; animation:sweep 0.5s ease-in-out infinite alternate; }
    @keyframes sweep { from{transform:rotate(-20deg) translateX(-8px)} to{transform:rotate(20deg) translateX(8px)} }
    .anim-text { font-family:'Orbitron',sans-serif; color:var(--accent); font-size:14px; letter-spacing:3px; }
    .particles { position:absolute; inset:0; pointer-events:none; overflow:hidden; }
    .particle {
      position:absolute; width:4px; height:4px; border-radius:50%;
      animation:fall 1.5s linear infinite;
    }
    @keyframes fall { 0%{opacity:1;transform:translateY(-20px)} 100%{opacity:0;transform:translateY(100vh)} }

    /* â”€â”€â”€ RESULTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .result-grid { display:grid; grid-template-columns:repeat(3,1fr); gap:8px; margin-top:12px; }
    .result-card { background:var(--surface2); border:1px solid var(--border); border-radius:4px; padding:11px; text-align:center; }
    .result-num  { font-family:'Orbitron',sans-serif; font-size:18px; font-weight:700; }
    .result-lbl  { font-size:8px; color:var(--text2); text-transform:uppercase; letter-spacing:1px; margin-top:3px; }
    .result-det  { margin-top:10px; font-size:9px; color:var(--text2); line-height:2; }

    /* â”€â”€â”€ TOAST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #toastContainer { position:fixed; top:70px; right:18px; z-index:1000; display:flex; flex-direction:column; gap:8px; }
    .toast {
      background:var(--surface); border:1px solid var(--border); border-radius:4px;
      padding:10px 16px; font-size:11px; min-width:260px; max-width:340px;
      animation:toastIn .3s; box-shadow:0 4px 20px rgba(0,0,0,.4);
    }
    @keyframes toastIn { from{opacity:0;transform:translateX(20px)} to{opacity:1;transform:none} }
    .toast.ok   { border-left:3px solid var(--accent3); }
    .toast.err  { border-left:3px solid var(--danger);  }
    .toast.info { border-left:3px solid var(--accent);  }
    .toast.warn { border-left:3px solid var(--warn);    }

    /* â”€â”€â”€ LOG â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .log-box {
      background:var(--surface); border:1px solid var(--border); border-radius:4px;
      padding:10px 12px; font-size:9px; max-height:140px; overflow-y:auto; line-height:2;
    }
    .ll      { color:var(--text2); }
    .ll.ok   { color:var(--accent3); }
    .ll.err  { color:var(--danger); }
    .ll.info { color:var(--accent); }
    .ll.warn { color:var(--warn); }

    /* â”€â”€â”€ MONITOR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .monitor-grid { display:grid; grid-template-columns:repeat(4,1fr); gap:10px; margin-bottom:14px; }
    .gauge-card { background:var(--surface); border:1px solid var(--border); border-radius:4px; padding:14px; text-align:center; }
    .gauge-val { font-family:'Orbitron',sans-serif; font-size:24px; font-weight:700; }
    .gauge-lbl { font-size:8px; color:var(--text2); text-transform:uppercase; letter-spacing:1px; margin-top:3px; }
    .gauge-sub { font-size:9px; color:var(--text2); margin-top:4px; }

    .proc-table { width:100%; border-collapse:collapse; font-size:10px; }
    .proc-table th { background:var(--surface2); color:var(--text2); padding:7px 10px; text-align:left; font-size:8px; text-transform:uppercase; letter-spacing:1px; border-bottom:1px solid var(--border); }
    .proc-table td { padding:6px 10px; border-bottom:1px solid var(--border); }
    .proc-table tr:hover td { background:var(--surface2); }

    .mini-bar { height:4px; background:var(--border); border-radius:2px; overflow:hidden; margin-top:3px; }
    .mini-bar-fill { height:100%; border-radius:2px; transition:width .5s; }

    /* â”€â”€â”€ DUPLIKÃLT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .dup-group { background:var(--surface); border:1px solid var(--border); border-radius:4px; margin-bottom:10px; }
    .dup-header { display:flex; align-items:center; gap:10px; padding:11px 14px; cursor:pointer; }
    .dup-header:hover { background:var(--surface2); }
    .dup-hash { font-size:9px; color:var(--text2); font-family:'IBM Plex Mono',monospace; }
    .dup-waste { margin-left:auto; font-family:'Orbitron',sans-serif; font-size:12px; color:var(--warn); }
    .dup-files { padding:0 14px 12px; }
    .dup-file { display:flex; align-items:center; gap:10px; padding:6px 0; border-top:1px solid var(--border); font-size:10px; }
    .dup-path { flex:1; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; color:var(--text2); }
    .dup-sz { color:var(--accent2); font-weight:600; flex-shrink:0; }

    /* â”€â”€â”€ REGISTRY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .reg-item { background:var(--surface); border:1px solid var(--border); border-radius:4px; padding:12px 14px; margin-bottom:8px; display:flex; align-items:center; gap:12px; }
    .reg-ico { font-size:18px; flex-shrink:0; }
    .reg-info { flex:1; }
    .reg-desc { font-size:11px; color:var(--text); margin-bottom:2px; }
    .reg-path { font-size:9px; color:var(--text2); overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
    .reg-type { font-size:8px; padding:1px 5px; border-radius:2px; border:1px solid; margin-left:auto; flex-shrink:0; }

    /* â”€â”€â”€ SCHEDULE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .sched-card { background:var(--surface); border:1px solid var(--border); border-radius:4px; padding:18px; }
    .sched-row  { display:flex; align-items:center; gap:12px; padding:10px 0; border-bottom:1px solid var(--border); }
    .sched-row:last-child { border-bottom:none; }
    .sched-lbl  { font-size:11px; color:var(--text); flex:1; }
    .sched-sub  { font-size:9px; color:var(--text2); margin-top:2px; }

    /* â”€â”€â”€ PROFILE / SETTINGS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .settings-section { margin-bottom:20px; }
    .settings-title { font-size:10px; letter-spacing:2px; text-transform:uppercase; color:var(--text2); margin-bottom:10px; padding-bottom:6px; border-bottom:1px solid var(--border); }
    .form-row { display:flex; align-items:center; gap:10px; margin-bottom:10px; }
    .form-lbl { font-size:10px; color:var(--text2); width:160px; flex-shrink:0; }
    input[type="text"].styled, input[type="password"].styled, input[type="number"].styled {
      flex:1;
    }
    .toggle-wrap { display:flex; align-items:center; gap:8px; }
    .toggle { width:36px; height:20px; background:var(--border2); border-radius:10px; cursor:pointer; position:relative; transition:background .2s; flex-shrink:0; }
    .toggle.on { background:var(--accent); }
    .toggle::after { content:''; position:absolute; top:3px; left:3px; width:14px; height:14px; background:#fff; border-radius:50%; transition:transform .2s; }
    .toggle.on::after { transform:translateX(16px); }
    .toggle-lbl { font-size:10px; color:var(--text2); }

    /* â”€â”€â”€ DISK OVERVIEW / DONUT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .disk-overview { display:flex; gap:22px; align-items:center; padding:16px; background:var(--surface); border:1px solid var(--border); border-radius:4px; margin-bottom:16px; }
    canvas#diskChart { width:100px!important; height:100px!important; }
    .disk-legend { display:flex; flex-direction:column; gap:8px; flex:1; }
    .leg-row { display:flex; align-items:center; gap:8px; font-size:11px; }
    .leg-dot { width:8px; height:8px; border-radius:50%; flex-shrink:0; }
    .leg-lbl { color:var(--text2); flex:1; }
    .leg-val { color:var(--text); font-weight:600; }

    /* â”€â”€â”€ DISK BARS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .disk-item { display:grid; grid-template-columns:120px 1fr 80px; align-items:center; gap:10px; padding:8px 0; border-bottom:1px solid rgba(26,37,53,.5); }
    .disk-item:last-child { border-bottom:none; }
    .disk-name { font-size:10px; color:var(--text); }
    .disk-path { font-size:8px; color:var(--text2); margin-top:1px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
    .disk-bar-bg { height:4px; background:var(--border); border-radius:2px; overflow:hidden; }
    .disk-bar-fill { height:100%; background:linear-gradient(90deg,var(--accent),var(--accent2)); border-radius:2px; transition:width .7s; }
    .disk-sz { text-align:right; font-size:9px; color:var(--accent2); font-weight:600; }

    /* â”€â”€â”€ BACKUP LIST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .bk-row { display:flex; align-items:center; gap:10px; padding:9px 14px; border-bottom:1px solid var(--border); font-size:10px; }
    .bk-row:last-child { border-bottom:none; }
    .bk-name { flex:1; color:var(--text); }
    .bk-date { color:var(--text2); }
    .bk-sz   { color:var(--accent2); font-weight:600; }

    /* â”€â”€â”€ HISTORY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .hist-item { background:var(--surface); border:1px solid var(--border); border-radius:4px; padding:12px 16px; margin-bottom:8px; display:grid; grid-template-columns:1fr auto auto; gap:10px; align-items:center; }
    .hist-ts   { font-size:9px; color:var(--text2); margin-bottom:3px; }
    .hist-cats { font-size:11px; color:var(--text); }
    .hist-freed { font-family:'Orbitron',sans-serif; font-size:13px; color:var(--accent3); }
    .hist-files { font-size:9px; color:var(--text2); }

    /* â”€â”€â”€ LARGE FILES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .lf-controls { display:flex; gap:8px; align-items:center; margin-bottom:14px; flex-wrap:wrap; }
    .lf-input { background:var(--surface2); border:1px solid var(--border2); color:var(--text); font-family:'IBM Plex Mono',monospace; font-size:10px; padding:7px 10px; border-radius:3px; flex:1; min-width:180px; }
    .lf-input:focus { outline:none; border-color:var(--accent); }
    .lf-row { display:grid; grid-template-columns:1fr 90px 50px 28px; align-items:center; gap:10px; padding:7px 12px; border-bottom:1px solid var(--border); font-size:10px; }
    .lf-row:last-child { border-bottom:none; }
    .lf-row:hover { background:var(--surface2); }
    .lf-name { color:var(--text); overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
    .lf-fp   { font-size:8px; color:var(--text2); margin-top:1px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
    .lf-sz   { text-align:right; font-family:'Orbitron',sans-serif; font-size:11px; color:var(--accent2); }
    .ext-badge { font-size:8px; padding:1px 4px; border-radius:2px; text-align:center; background:var(--surface2); border:1px solid var(--border2); color:var(--text2); text-transform:uppercase; }
    .del-btn { background:none; border:none; cursor:pointer; font-size:12px; opacity:.5; transition:opacity .15s; }
    .del-btn:hover { opacity:1; }

    /* â”€â”€â”€ CUSTOM DIRS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .dir-tag { display:inline-flex; align-items:center; gap:6px; background:var(--surface2); border:1px solid var(--border2); border-radius:3px; padding:4px 8px; font-size:10px; margin:3px; }
    .dir-tag .rm { cursor:pointer; color:var(--danger); font-size:11px; }

    /* â”€â”€â”€ SCROLLBAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    ::-webkit-scrollbar { width:5px; }
    ::-webkit-scrollbar-track { background:var(--surface); }
    ::-webkit-scrollbar-thumb { background:var(--scrollbar); border-radius:3px; }

    /* â”€â”€â”€ PASSWORD MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .modal-overlay { display:none; position:fixed; inset:0; z-index:500; background:rgba(0,0,0,.6); align-items:center; justify-content:center; }
    .modal-overlay.visible { display:flex; }
    .modal { background:var(--surface); border:1px solid var(--border); border-radius:6px; padding:24px; min-width:320px; max-width:400px; }
    .modal-title { font-family:'Orbitron',sans-serif; font-size:14px; color:var(--accent); margin-bottom:16px; }

    /* â”€â”€â”€ RESPONSIVE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    @media(max-width:860px) {
      .app { grid-template-columns:1fr; }
      nav { flex-direction:row; overflow-x:auto; border-right:none; border-bottom:1px solid var(--border); padding:0; }
      .nav-item { border-left:none; border-bottom:3px solid transparent; padding:10px 10px; white-space:nowrap; }
      .nav-item.active { border-left-color:transparent; border-bottom-color:var(--accent); }
      .nav-sec, .nav-div, .nav-pill { display:none; }
      .grid-3 { grid-template-columns:1fr 1fr; }
      .monitor-grid { grid-template-columns:1fr 1fr; }
    }
  </style>
</head>
<body>

<!-- CLEAN ANIMATION OVERLAY -->
<div id="cleanAnim">
  <div class="particles" id="particles"></div>
  <div class="broom-wrap">ğŸ§¹</div>
  <div class="anim-text">TAKARÃTÃS FOLYAMATBAN...</div>
  <div id="animProgress" style="font-size:11px;color:var(--text2)"></div>
</div>

<!-- TOAST CONTAINER -->
<div id="toastContainer"></div>

<!-- PASSWORD MODAL -->
<div class="modal-overlay" id="pwModal">
  <div class="modal">
    <div class="modal-title">ğŸ”’ JelszÃ³ szÃ¼ksÃ©ges</div>
    <p style="font-size:11px;color:var(--text2);margin-bottom:14px">Ez a profil jelszÃ³val vÃ©dett.</p>
    <input type="password" id="pwInput" class="styled" placeholder="JelszÃ³..." style="width:100%;margin-bottom:14px">
    <div style="display:flex;gap:8px">
      <button class="btn btn-p" onclick="submitPassword()">BelÃ©pÃ©s</button>
      <button class="btn btn-s" onclick="closePwModal()">MÃ©gse</button>
    </div>
  </div>
</div>

<div class="app">

  <!-- HEADER -->
  <header>
    <div class="logo">Py<span>Cleaner</span></div>
    <div class="ver">v3.0</div>
    <div class="hdr-right">
      <select class="profile-sel" id="profileSel" onchange="switchProfile(this.value)"></select>
      <button class="theme-btn" id="themeBtn" onclick="toggleTheme()" title="TÃ©ma vÃ¡ltÃ¡sa">ğŸŒ™</button>
      <div class="sys-badge" id="sysBadge">BetÃ¶ltÃ©s...</div>
    </div>
  </header>

  <!-- SIDEBAR -->
  <nav>
    <div class="nav-sec">TisztÃ­tÃ¡s</div>
    <div class="nav-item active" data-page="cleaner">
      <span class="nav-icon">ğŸ§¹</span>TisztÃ­tÃ³
      <span class="nav-pill warn" id="navClean">â€”</span>
    </div>
    <div class="nav-item" data-page="monitor">
      <span class="nav-icon">ğŸ“¡</span>Ã‰lÅ‘ Monitor
      <span class="nav-pill" id="navCPU">â€”</span>
    </div>
    <div class="nav-div"></div>
    <div class="nav-sec">ElemzÃ©s</div>
    <div class="nav-item" data-page="analyzer">
      <span class="nav-icon">ğŸ“Š</span>Lemez elemzÅ‘
    </div>
    <div class="nav-item" data-page="largefiles">
      <span class="nav-icon">ğŸ”</span>Nagy fÃ¡jlok
    </div>
    <div class="nav-item" data-page="duplicates">
      <span class="nav-icon">ğŸ‘¥</span>DuplikÃ¡tumok
      <span class="nav-pill warn" id="navDup">â€”</span>
    </div>
    <div class="nav-item" data-page="registry">
      <span class="nav-icon">ğŸ—ï¸</span>Registry
      <span class="nav-pill hot" id="navReg">â€”</span>
    </div>
    <div class="nav-div"></div>
    <div class="nav-sec">Rendszer</div>
    <div class="nav-item" data-page="system">
      <span class="nav-icon">ğŸ–¥ï¸</span>Rendszerinfo
      <span class="nav-pill ok" id="navDisk">â€”</span>
    </div>
    <div class="nav-item" data-page="schedule">
      <span class="nav-icon">â°</span>ÃœtemezÅ‘
      <span class="nav-pill ok" id="navSched">OFF</span>
    </div>
    <div class="nav-item" data-page="backups">
      <span class="nav-icon">ğŸ’¾</span>BiztonsÃ¡gi mÃ¡solatok
      <span class="nav-pill" id="navBk">0</span>
    </div>
    <div class="nav-item" data-page="history">
      <span class="nav-icon">ğŸ“œ</span>ElÅ‘zmÃ©nyek
      <span class="nav-pill" id="navHist">0</span>
    </div>
    <div class="nav-div"></div>
    <div class="nav-item" data-page="settings">
      <span class="nav-icon">âš™ï¸</span>BeÃ¡llÃ­tÃ¡sok
    </div>
    <div class="nav-item" data-page="log">
      <span class="nav-icon">ğŸ“‹</span>NaplÃ³
    </div>
  </nav>

  <main>

    <!-- â•â•â•â•â•â•â•â•â•â• CLEANER â•â•â•â•â•â•â•â•â•â• -->
    <div class="page active" id="page-cleaner">
      <div class="page-title">RendszertisztÃ­tÃ³</div>
      <div class="page-sub">JelÃ¶ld ki a tisztÃ­tandÃ³ elemeket â†’ BeolvasÃ¡s â†’ TisztÃ­tÃ¡s</div>

      <div class="c-items" id="cleanerItems">
        <div class="c-item selected" data-category="temp">
          <div class="chk">âœ“</div>
          <div class="ci-info"><div class="ci-name">ğŸ—‚ï¸ Ideiglenes fÃ¡jlok</div><div class="ci-desc">%TEMP%, %TMP%, %WINDIR%\Temp, /tmp mappÃ¡k</div></div>
          <div class="ci-size"><div class="ci-val" id="sz-temp">â€”</div><div class="ci-fc" id="fc-temp"></div></div>
        </div>
        <div class="c-item selected" data-category="browser">
          <div class="chk">âœ“</div>
          <div class="ci-info"><div class="ci-name">ğŸŒ BÃ¶ngÃ©szÅ‘ gyorsÃ­tÃ³tÃ¡r</div><div class="ci-desc">Chrome, Edge, Firefox, Brave â€“ cache, GPUCache, Code Cache</div></div>
          <div class="ci-size"><div class="ci-val" id="sz-browser">â€”</div><div class="ci-fc" id="fc-browser"></div></div>
        </div>
        <div class="c-item selected" data-category="logs">
          <div class="chk">âœ“</div>
          <div class="ci-info"><div class="ci-name">ğŸ“„ Log fÃ¡jlok</div><div class="ci-desc">Rendszer- Ã©s app-naplÃ³k (.log, .bak, .old, .tmp)</div></div>
          <div class="ci-size"><div class="ci-val" id="sz-logs">â€”</div><div class="ci-fc" id="fc-logs"></div></div>
        </div>
        <div class="c-item selected" data-category="thumbnails">
          <div class="chk">âœ“</div>
          <div class="ci-info"><div class="ci-name">ğŸ–¼ï¸ BÃ©lyegkÃ©p cache</div><div class="ci-desc">Windows Explorer thumbcache, ~/.cache/thumbnails</div></div>
          <div class="ci-size"><div class="ci-val" id="sz-thumbnails">â€”</div><div class="ci-fc" id="fc-thumbnails"></div></div>
        </div>
        <div class="c-item" data-category="custom" id="customItem">
          <div class="chk"></div>
          <div class="ci-info"><div class="ci-name">ğŸ“ EgyÃ©ni mappÃ¡k</div><div class="ci-desc" id="customDirsDesc">Nincs egyÃ©ni mappa â€” Ã¡llÃ­tsd be a BeÃ¡llÃ­tÃ¡sokban</div></div>
          <div class="ci-size"><div class="ci-val" id="sz-custom">â€”</div><div class="ci-fc" id="fc-custom"></div></div>
        </div>
        <div class="c-item" data-category="trash">
          <div class="chk"></div>
          <div class="ci-info"><div class="ci-name">ğŸ—‘ï¸ LomtÃ¡r</div><div class="ci-desc">Visszavonhatatlan tÃ¶rlÃ©s! EllenÅ‘rizd a tartalmÃ¡t elÅ‘tte.</div></div>
          <div class="ci-size"><div class="ci-val" id="sz-trash">â€”</div><div class="ci-fc" id="fc-trash"></div></div>
        </div>
      </div>

      <div class="action-bar">
        <button class="btn btn-p" onclick="runScan()">ğŸ” BeolvasÃ¡s</button>
        <button class="btn btn-d" id="cleanBtn" onclick="runClean()" disabled>âš¡ TisztÃ­tÃ¡s</button>
        <button class="btn btn-s btn-sm" onclick="selAll()">â˜‘ Mind</button>
        <button class="btn btn-s btn-sm" onclick="selNone()">â˜ Egyik sem</button>
        <div class="age-filter">
          <label>Kor:</label>
          <select class="styled" id="ageFilter">
            <option value="0">Mindent tÃ¶rÃ¶l</option>
            <option value="1">1 napnÃ¡l rÃ©gebbi</option>
            <option value="7">7 napnÃ¡l rÃ©gebbi</option>
            <option value="30">30 napnÃ¡l rÃ©gebbi</option>
          </select>
        </div>
        <div class="action-total">
          <div class="total-lbl">FelszabadÃ­thatÃ³</div>
          <div class="total-val" id="totalFreeable">â€”</div>
        </div>
      </div>

      <div class="prog-wrap" id="progWrap">
        <div class="prog-lbl" id="progLabel">...</div>
        <div class="prog-bg"><div class="prog-fill ind" id="progFill"></div></div>
        <div id="resultArea"></div>
      </div>

      <div style="margin-top:10px">
        <div class="log-box" id="cleanerLog">
          <div class="ll info">[ PyCleaner v3.0 ] KÃ©sz. IndÃ­tsd a beolvasÃ¡st.</div>
        </div>
      </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â• MONITOR â•â•â•â•â•â•â•â•â•â• -->
    <div class="page" id="page-monitor">
      <div class="page-title">Ã‰lÅ‘ Rendszermonitor</div>
      <div class="page-sub">ValÃ³s idejÅ± CPU, RAM, Swap, Lemez, HÃ¡lÃ³zat Ã©s folyamatok</div>

      <div class="monitor-grid">
        <div class="gauge-card">
          <div class="gauge-val" id="monCPU" style="color:var(--accent)">â€”</div>
          <div class="gauge-lbl">CPU</div>
          <div class="mini-bar"><div class="mini-bar-fill" id="monCPUBar" style="background:var(--accent);width:0%"></div></div>
        </div>
        <div class="gauge-card">
          <div class="gauge-val" id="monRAM" style="color:var(--accent2)">â€”</div>
          <div class="gauge-lbl">RAM</div>
          <div class="mini-bar"><div class="mini-bar-fill" id="monRAMBar" style="background:var(--accent2);width:0%"></div></div>
          <div class="gauge-sub" id="monRAMSub"></div>
        </div>
        <div class="gauge-card">
          <div class="gauge-val" id="monSwap" style="color:var(--warn)">â€”</div>
          <div class="gauge-lbl">Swap</div>
          <div class="mini-bar"><div class="mini-bar-fill" id="monSwapBar" style="background:var(--warn);width:0%"></div></div>
          <div class="gauge-sub" id="monSwapSub"></div>
        </div>
        <div class="gauge-card">
          <div class="gauge-val" id="monDisk" style="color:var(--accent3)">â€”</div>
          <div class="gauge-lbl">Lemez (tele)</div>
          <div class="mini-bar"><div class="mini-bar-fill" id="monDiskBar" style="background:var(--accent3);width:0%"></div></div>
          <div class="gauge-sub" id="monDiskSub"></div>
        </div>
      </div>

      <div class="grid-2" style="margin-bottom:14px">
        <div class="card">
          <div class="card-hdr"><span class="card-lbl">HÃ¡lÃ³zat â€“ KÃ¼ldÃ¶tt</span><span class="card-ico">ğŸ“¤</span></div>
          <div class="stat" id="monNetSent" style="font-size:16px">â€”</div>
        </div>
        <div class="card">
          <div class="card-hdr"><span class="card-lbl">HÃ¡lÃ³zat â€“ Fogadott</span><span class="card-ico">ğŸ“¥</span></div>
          <div class="stat" id="monNetRecv" style="font-size:16px;color:var(--accent2)">â€”</div>
        </div>
      </div>

      <div class="card">
        <div class="card-hdr"><span class="card-lbl">Top folyamatok (RAM szerint)</span><span class="card-ico">ğŸ”¬</span></div>
        <table class="proc-table" id="procTable">
          <thead><tr><th>PID</th><th>Folyamat</th><th>RAM %</th><th>CPU %</th></tr></thead>
          <tbody id="procBody"><tr><td colspan="4" style="color:var(--text2);padding:14px;text-align:center">BetÃ¶ltÃ©s...</td></tr></tbody>
        </table>
      </div>

      <div style="margin-top:10px;font-size:9px;color:var(--text2)" id="monTs">FrissÃ­tve: â€”</div>
      <div id="monError" style="display:none;margin-top:10px;font-size:11px;color:var(--danger)"></div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â• ANALYZER â•â•â•â•â•â•â•â•â•â• -->
    <div class="page" id="page-analyzer">
      <div class="page-title">Lemez ElemzÅ‘</div>
      <div class="page-sub">FelhasznÃ¡lÃ³i mappÃ¡k mÃ©rete</div>
      <div id="analyzerContent" style="text-align:center;padding:40px;color:var(--text2)">
        <div style="font-size:36px;margin-bottom:12px">ğŸ“Š</div>
        <div style="font-size:11px">Kattints az "ElemzÃ©s" gombra</div>
      </div>
      <div style="margin-top:14px">
        <button class="btn btn-p" onclick="runAnalyzer()">ğŸ“Š ElemzÃ©s indÃ­tÃ¡sa</button>
      </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â• LARGE FILES â•â•â•â•â•â•â•â•â•â• -->
    <div class="page" id="page-largefiles">
      <div class="page-title">Nagy FÃ¡jlok</div>
      <div class="page-sub">Keresd meg a legtÃ¶bb helyet foglalÃ³ fÃ¡jlokat</div>
      <div class="lf-controls">
        <input class="lf-input" id="lfPath" type="text" placeholder="Mappa (pl. C:\Users\csibe)">
        <input class="lf-input" id="lfMinMB" type="number" placeholder="Min. MB" value="50" style="flex:0;width:90px">
        <button class="btn btn-p" onclick="runLargeFiles()">ğŸ” KeresÃ©s</button>
      </div>
      <div id="lfResults" style="text-align:center;padding:30px;color:var(--text2);font-size:11px">MÃ©g nem futott keresÃ©s</div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â• DUPLICATES â•â•â•â•â•â•â•â•â•â• -->
    <div class="page" id="page-duplicates">
      <div class="page-title">DuplikÃ¡lt FÃ¡jlok</div>
      <div class="page-sub">Azonos tartalmÃº fÃ¡jlok keresÃ©se MD5 hash alapjÃ¡n</div>
      <div class="lf-controls">
        <input class="lf-input" id="dupPath" type="text" placeholder="KeresÃ©si mappa">
        <input class="lf-input" type="number" id="dupMinKB" value="10" placeholder="Min. KB" style="flex:0;width:90px">
        <button class="btn btn-p" onclick="runDuplicates()">ğŸ” KeresÃ©s</button>
      </div>
      <div id="dupWarning" style="display:none;background:rgba(255,184,48,.1);border:1px solid var(--warn);border-radius:4px;padding:10px 14px;font-size:10px;color:var(--warn);margin-bottom:12px">
        âš ï¸ Nagy mappÃ¡kban a keresÃ©s hosszÃº ideig tarthat!
      </div>
      <div id="dupSummary" style="display:none;margin-bottom:12px"></div>
      <div id="dupResults"></div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â• REGISTRY â•â•â•â•â•â•â•â•â•â• -->
    <div class="page" id="page-registry">
      <div class="page-title">Registry TisztÃ­tÃ¡s</div>
      <div class="page-sub">Windows rendszerleÃ­rÃ³ adatbÃ¡zis hibÃ¡s bejegyzÃ©sek keresÃ©se</div>
      <div id="regStatus" style="padding:20px;text-align:center;color:var(--text2);font-size:11px">
        Kattints a "BeolvasÃ¡s" gombra a registry elemzÃ©sÃ©hez.
      </div>
      <div style="margin-bottom:14px;display:flex;gap:8px">
        <button class="btn btn-p" onclick="runRegScan()">ğŸ” Registry beolvasÃ¡s</button>
        <button class="btn btn-d" id="regCleanAllBtn" style="display:none" onclick="cleanAllRegistry()">ğŸ—‘ï¸ Ã–sszes javÃ­tÃ¡sa</button>
      </div>
      <div id="regResults"></div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â• SYSTEM â•â•â•â•â•â•â•â•â•â• -->
    <div class="page" id="page-system">
      <div class="page-title">RendszerinformÃ¡ciÃ³</div>
      <div class="page-sub">AktuÃ¡lis rendszer Ã©s lemezhasznÃ¡lat</div>
      <div class="disk-overview">
        <canvas id="diskChart" width="100" height="100"></canvas>
        <div class="disk-legend" id="diskLegend"><div style="color:var(--text2);font-size:10px">BetÃ¶ltÃ©s...</div></div>
      </div>
      <div class="grid-3" style="margin-bottom:16px">
        <div class="card"><div class="card-hdr"><span class="card-lbl">OperÃ¡ciÃ³s rendszer</span><span class="card-ico">ğŸ–¥ï¸</span></div><div class="stat" style="font-size:12px" id="sysOS">â€”</div></div>
        <div class="card"><div class="card-hdr"><span class="card-lbl">Processzor</span><span class="card-ico">âš™ï¸</span></div><div class="stat" style="font-size:11px" id="sysCPU">â€”</div></div>
        <div class="card"><div class="card-hdr"><span class="card-lbl">HostnÃ©v</span><span class="card-ico">ğŸ”Œ</span></div><div class="stat" style="font-size:12px" id="sysHost">â€”</div></div>
        <div class="card"><div class="card-hdr"><span class="card-lbl">Ã–sszesen</span><span class="card-ico">ğŸ’¾</span></div><div class="stat" id="sysDT">â€”</div></div>
        <div class="card"><div class="card-hdr"><span class="card-lbl">FelhasznÃ¡lt</span><span class="card-ico">ğŸ“ˆ</span></div><div class="stat" style="color:var(--accent2)" id="sysDU">â€”</div></div>
        <div class="card"><div class="card-hdr"><span class="card-lbl">Szabad</span><span class="card-ico">âœ…</span></div><div class="stat" style="color:var(--accent3)" id="sysDF">â€”</div></div>
      </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â• SCHEDULE â•â•â•â•â•â•â•â•â•â• -->
    <div class="page" id="page-schedule">
      <div class="page-title">Automatikus ÃœtemezÅ‘</div>
      <div class="page-sub">Automatikus rendszertisztÃ­tÃ¡s beÃ¡llÃ­tÃ¡sa hÃ¡ttÃ©rben</div>
      <div class="sched-card">
        <div class="sched-row">
          <div><div class="sched-lbl">ÃœtemezÅ‘ engedÃ©lyezve</div><div style="font-size:9px;color:var(--text2)">A szerver hÃ¡ttÃ©rben futtatja a tisztÃ­tÃ¡st</div></div>
          <div class="toggle" id="schedToggle" onclick="toggleSched()"></div>
        </div>
        <div class="sched-row">
          <div class="sched-lbl">IsmÃ©tlÃ©si idÅ‘kÃ¶z</div>
          <select class="styled" id="schedInterval">
            <option value="1">Minden Ã³ra</option>
            <option value="6">6 Ã³rÃ¡nkÃ©nt</option>
            <option value="12">12 Ã³rÃ¡nkÃ©nt</option>
            <option value="24" selected>24 Ã³rÃ¡nkÃ©nt</option>
            <option value="168">Hetente</option>
          </select>
        </div>
        <div class="sched-row">
          <div class="sched-lbl">KategÃ³riÃ¡k</div>
          <div style="display:flex;gap:6px;flex-wrap:wrap">
            <label style="font-size:10px;display:flex;gap:4px;align-items:center"><input type="checkbox" id="scat-temp" checked> Ideiglenes</label>
            <label style="font-size:10px;display:flex;gap:4px;align-items:center"><input type="checkbox" id="scat-browser" checked> BÃ¶ngÃ©szÅ‘</label>
            <label style="font-size:10px;display:flex;gap:4px;align-items:center"><input type="checkbox" id="scat-logs" checked> Logok</label>
            <label style="font-size:10px;display:flex;gap:4px;align-items:center"><input type="checkbox" id="scat-thumbnails"> BÃ©lyegkÃ©pek</label>
          </div>
        </div>
        <div class="sched-row">
          <div><div class="sched-lbl">UtolsÃ³ automatikus futÃ¡s</div></div>
          <div id="schedLastRun" style="font-size:10px;color:var(--text2)">Soha</div>
        </div>
        <div style="padding-top:14px">
          <button class="btn btn-p" onclick="saveSched()">ğŸ’¾ MentÃ©s</button>
          <button class="btn btn-s btn-sm" onclick="runNow()" style="margin-left:8px">â–¶ Azonnali futtatÃ¡s</button>
        </div>
      </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â• BACKUPS â•â•â•â•â•â•â•â•â•â• -->
    <div class="page" id="page-backups">
      <div class="page-title">BiztonsÃ¡gi MÃ¡solatok</div>
      <div class="page-sub">TÃ¶rlÃ©s elÅ‘tt automatikusan kÃ©szÃ­tett biztonsÃ¡gi mentÃ©sek</div>
      <div style="margin-bottom:14px;display:flex;gap:8px">
        <button class="btn btn-p btn-sm" onclick="loadBackups()">ğŸ”„ FrissÃ­tÃ©s</button>
        <a class="btn btn-g btn-sm" href="/api/export/html" target="_blank">ğŸ“Š HTML Riport</a>
        <a class="btn btn-s btn-sm" href="/api/export/json" target="_blank">ğŸ“„ JSON Export</a>
      </div>
      <div id="backupList" class="card" style="padding:0"><div style="padding:20px;text-align:center;color:var(--text2);font-size:11px">BetÃ¶ltÃ©s...</div></div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â• HISTORY â•â•â•â•â•â•â•â•â•â• -->
    <div class="page" id="page-history">
      <div class="page-title">TisztÃ­tÃ¡si ElÅ‘zmÃ©nyek</div>
      <div class="page-sub">KorÃ¡bbi mÅ±veletek Ã©s statisztikÃ¡k</div>
      <div style="display:flex;gap:8px;margin-bottom:14px">
        <button class="btn btn-p btn-sm" onclick="loadHistory()">ğŸ”„ FrissÃ­tÃ©s</button>
        <button class="btn btn-s btn-sm" onclick="clearHistory()">ğŸ—‘ï¸ TÃ¶rlÃ©s</button>
      </div>
      <div id="histContent" style="color:var(--text2);font-size:11px;padding:20px">BetÃ¶ltÃ©s...</div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â• SETTINGS â•â•â•â•â•â•â•â•â•â• -->
    <div class="page" id="page-settings">
      <div class="page-title">BeÃ¡llÃ­tÃ¡sok & Profilok</div>
      <div class="page-sub">TestreszabÃ¡s, profilok, biztonsÃ¡gi mentÃ©sek</div>

      <div class="settings-section">
        <div class="settings-title">AktÃ­v profil</div>
        <div class="form-row">
          <span class="form-lbl">Profil neve</span>
          <input type="text" class="styled" id="cfgProfileName" placeholder="Profil neve">
        </div>
        <div class="form-row">
          <span class="form-lbl">Profil jelszÃ³</span>
          <input type="password" class="styled" id="cfgPassword" placeholder="Ãœresen hagyva = nincs vÃ©delem">
        </div>
        <div class="form-row">
          <span class="form-lbl">Backup limit (MB)</span>
          <input type="number" class="styled" id="cfgBackupMB" value="200" style="width:100px;flex:none">
        </div>
        <div class="form-row">
          <span class="form-lbl">Auto backup tÃ¶rlÃ©s elÅ‘tt</span>
          <div class="toggle-wrap">
            <div class="toggle on" id="cfgAutoBackup" onclick="this.classList.toggle('on')"></div>
            <span class="toggle-lbl">BiztonsÃ¡gi mentÃ©s kÃ©szÃ­tÃ©se tÃ¶rlÃ©s elÅ‘tt</span>
          </div>
        </div>
      </div>

      <div class="settings-section">
        <div class="settings-title">EgyÃ©ni mappÃ¡k</div>
        <div id="customDirTags" style="margin-bottom:8px"></div>
        <div style="display:flex;gap:8px">
          <input type="text" class="styled" id="newDirInput" placeholder="Mappa elÃ©rÃ©si Ãºtja (pl. D:\MyCache)">
          <button class="btn btn-s btn-sm" onclick="addCustomDir()">+ HozzÃ¡adÃ¡s</button>
        </div>
      </div>

      <div class="settings-section">
        <div class="settings-title">Ãšj profil</div>
        <div style="display:flex;gap:8px">
          <input type="text" class="styled" id="newProfileName" placeholder="Ãšj profil neve">
          <button class="btn btn-p btn-sm" onclick="createProfile()">+ LÃ©trehozÃ¡s</button>
        </div>
      </div>

      <div style="margin-top:16px;display:flex;gap:8px">
        <button class="btn btn-p" onclick="saveSettings()">ğŸ’¾ BeÃ¡llÃ­tÃ¡sok mentÃ©se</button>
        <button class="btn btn-d btn-sm" onclick="deleteProfile()">ğŸ—‘ï¸ Profil tÃ¶rlÃ©se</button>
      </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â• LOG â•â•â•â•â•â•â•â•â•â• -->
    <div class="page" id="page-log">
      <div class="page-title">EsemÃ©nynaplÃ³</div>
      <div class="page-sub">Ã–sszes PyCleaner mÅ±velet naplÃ³zÃ¡sa</div>
      <div class="card">
        <div class="log-box" id="eventLog" style="max-height:520px">
          <div class="ll info">[ PyCleaner v3.0 ] NaplÃ³ indÃ­tva.</div>
        </div>
      </div>
      <div style="margin-top:10px">
        <button class="btn btn-s btn-sm" onclick="document.getElementById('eventLog').innerHTML='<div class=\'ll info\'>[ NaplÃ³ tÃ¶rÃ¶lve ]</div>'">ğŸ—‘ï¸ NaplÃ³ tÃ¶rlÃ©se</button>
      </div>
    </div>

  </main>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let scanData = {};
let monitorES = null;
let regIssues = [];
let _theme = localStorage.getItem('pycleaner_theme') || 'dark';
let _config = null;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
document.addEventListener('DOMContentLoaded', () => {
  applyTheme(_theme);
  loadSysInfo();
  loadConfig();
  loadScheduleUI();
  loadBackups();
  loadHistory();

  // Set large files default path
  document.getElementById('lfPath').value = 'C:\\Users';
  document.getElementById('dupPath').value = 'C:\\Users';
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// THEME
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function toggleTheme() {
  _theme = _theme === 'dark' ? 'light' : 'dark';
  applyTheme(_theme);
  localStorage.setItem('pycleaner_theme', _theme);
}
function applyTheme(t) {
  document.documentElement.setAttribute('data-theme', t);
  document.getElementById('themeBtn').textContent = t === 'dark' ? 'â˜€ï¸' : 'ğŸŒ™';
  _theme = t;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NAVIGATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
document.querySelectorAll('.nav-item').forEach(item => {
  item.addEventListener('click', () => {
    document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    item.classList.add('active');
    const page = item.dataset.page;
    document.getElementById('page-' + page).classList.add('active');
    if (page === 'system')   loadSysInfo();
    if (page === 'monitor')  startMonitor();
    if (page === 'history')  loadHistory();
    if (page === 'backups')  loadBackups();
    if (page === 'schedule') loadScheduleUI();
    if (page === 'settings') loadSettingsUI();
    if (page !== 'monitor')  stopMonitor();
  });
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CHECKBOX
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
document.querySelectorAll('.c-item').forEach(item => {
  item.addEventListener('click', () => {
    item.classList.toggle('selected');
    item.querySelector('.chk').textContent = item.classList.contains('selected') ? 'âœ“' : '';
    updateTotal();
  });
});

function selAll()  { document.querySelectorAll('.c-item').forEach(i => { i.classList.add('selected'); i.querySelector('.chk').textContent = 'âœ“'; }); updateTotal(); }
function selNone() { document.querySelectorAll('.c-item').forEach(i => { i.classList.remove('selected'); i.querySelector('.chk').textContent = ''; }); updateTotal(); }
function getSelected() { return [...document.querySelectorAll('.c-item.selected')].map(i => i.dataset.category); }

function updateTotal() {
  let t = 0;
  getSelected().forEach(cat => { if (scanData[cat]) t += scanData[cat].size || 0; });
  document.getElementById('totalFreeable').textContent = t > 0 ? fmtB(t) : 'â€”';
  document.getElementById('navClean').textContent = t > 0 ? fmtB(t) : 'â€”';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TOAST
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function toast(msg, type = 'info', dur = 4000) {
  const d = document.createElement('div');
  d.className = `toast ${type}`;
  d.textContent = msg;
  document.getElementById('toastContainer').appendChild(d);
  setTimeout(() => d.remove(), dur);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LOG
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function addLog(msg, type = '') {
  const t = new Date().toLocaleTimeString('hu-HU');
  ['cleanerLog', 'eventLog'].forEach(id => {
    const el = document.getElementById(id);
    if (!el) return;
    const line = document.createElement('div');
    line.className = 'll ' + type;
    line.textContent = `[${t}] ${msg}`;
    el.appendChild(line);
    el.scrollTop = 9999;
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SCAN
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function runScan() {
  document.getElementById('progWrap').classList.add('visible');
  setProgress('ind', 'BeolvasÃ¡s...');
  document.getElementById('resultArea').innerHTML = '';
  document.getElementById('cleanBtn').disabled = true;
  addLog('BeolvasÃ¡s indÃ­tva...', 'info');
  ['temp','browser','logs','thumbnails','custom','trash','downloads'].forEach(cat => {
    const v = document.getElementById('sz-'+cat); const f = document.getElementById('fc-'+cat);
    if (v) v.innerHTML = '<span class="ci-scan">â€¦</span>';
    if (f) f.textContent = '';
  });
  try {
    const res = await fetch('/api/scan', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({category:'all'}) });
    scanData = await res.json();
    ['temp','browser','logs','thumbnails','custom','trash','downloads'].forEach(cat => {
      const d = scanData[cat]; if (!d) return;
      const v = document.getElementById('sz-'+cat); const f = document.getElementById('fc-'+cat);
      if (v) v.textContent = d.size_fmt;
      if (f) f.textContent = d.files + ' fÃ¡jl';
    });
    updateTotal();
    setProgress('done', 'âœ… BeolvasÃ¡s kÃ©sz');
    document.getElementById('cleanBtn').disabled = false;
    if (scanData.disk) document.getElementById('navDisk').textContent = scanData.disk.used_pct + '%';
    let t = 0; getSelected().forEach(cat => { if (scanData[cat]) t += scanData[cat].size || 0; });
    addLog('BeolvasÃ¡s kÃ©sz. FelszabadÃ­thatÃ³: ' + fmtB(t), 'ok');
    toast('BeolvasÃ¡s kÃ©sz â€” ' + fmtB(t) + ' felszabadÃ­thatÃ³', 'ok');
  } catch(e) { addLog('Hiba: ' + e, 'err'); setProgress('done', 'âŒ Hiba'); }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CLEAN
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function runClean() {
  const selected = getSelected().filter(c => c !== 'downloads');
  if (!selected.length) { toast('Nincs kivÃ¡lasztott elem!', 'warn'); return; }
  const minAge = parseInt(document.getElementById('ageFilter').value);
  if (!confirm(`âš ï¸ Biztosan tÃ¶rlÃ¶d?\n\nKategÃ³riÃ¡k: ${selected.join(', ')}\n\nEz NEM vonhatÃ³ vissza!`)) return;

  // Show animation
  showCleanAnim();
  document.getElementById('cleanBtn').disabled = true;
  addLog('TisztÃ­tÃ¡s: ' + selected.join(', '), 'warn');

  try {
    const res = await fetch('/api/clean', {
      method:'POST', headers:{'Content-Type':'application/json'},
      body: JSON.stringify({categories: selected, min_age_days: minAge})
    });
    const data = await res.json();
    hideCleanAnim();
    setProgress('done', 'âœ… TisztÃ­tÃ¡s kÃ©sz!');
    document.getElementById('resultArea').innerHTML = `
      <div class="result-grid">
        <div class="result-card"><div class="result-num" style="color:var(--accent3)">${data.total_freed}</div><div class="result-lbl">FelszabadÃ­tva</div></div>
        <div class="result-card"><div class="result-num" style="color:var(--accent)">${data.total_files}</div><div class="result-lbl">TÃ¶rÃ¶lt elem</div></div>
        <div class="result-card"><div class="result-num" style="color:${data.total_errors>0?'var(--danger)':'var(--accent3)'}">${data.total_errors}</div><div class="result-lbl">Hiba</div></div>
      </div>
      <div class="result-det">${data.details.map(d=>`â–¸ ${d.category}: ${d.files} elem, ${d.freed}`).join('<br>')}
      ${data.backup_url ? `<br><a href="${data.backup_url}" style="color:var(--accent)">ğŸ’¾ Backup letÃ¶ltÃ©se</a>` : ''}</div>`;
    addLog(`KÃ©sz! ${data.total_freed}, ${data.total_files} fÃ¡jl, ${data.total_errors} hiba`, 'ok');
    toast(`âœ… TisztÃ­tÃ¡s kÃ©sz â€” ${data.total_freed} felszabadÃ­tva`, 'ok', 6000);
    document.getElementById('navHist').textContent = parseInt(document.getElementById('navHist').textContent||0)+1;
    setTimeout(runScan, 800);
  } catch(e) {
    hideCleanAnim();
    addLog('Hiba: '+e, 'err');
    document.getElementById('cleanBtn').disabled = false;
    toast('Hiba a tisztÃ­tÃ¡s sorÃ¡n', 'err');
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ANIMATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showCleanAnim() {
  const el = document.getElementById('cleanAnim');
  el.classList.add('visible');
  const pc = document.getElementById('particles');
  pc.innerHTML = '';
  const colors = ['#00c8f0','#ff6b35','#5eff6e','#ffb830'];
  for (let i = 0; i < 40; i++) {
    const p = document.createElement('div');
    p.className = 'particle';
    p.style.cssText = `left:${Math.random()*100}%;top:${Math.random()*100}%;background:${colors[i%colors.length]};animation-delay:${Math.random()*2}s;animation-duration:${1+Math.random()*2}s`;
    pc.appendChild(p);
  }
  setProgress('ind', 'TakarÃ­tÃ¡s folyamatban...');
  document.getElementById('progWrap').classList.add('visible');
}
function hideCleanAnim() {
  document.getElementById('cleanAnim').classList.remove('visible');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PROGRESS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function setProgress(state, label) {
  document.getElementById('progLabel').textContent = label;
  const f = document.getElementById('progFill');
  if (state === 'ind') { f.className = 'prog-fill ind'; f.style.width = ''; }
  else                 { f.className = 'prog-fill'; f.style.width = '100%'; }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MONITOR
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function startMonitor() {
  if (monitorES) return;
  monitorES = new EventSource('/api/monitor');
  monitorES.onmessage = e => {
    try {
      const d = JSON.parse(e.data);
      if (d.error) {
        document.getElementById('monError').style.display = 'block';
        document.getElementById('monError').textContent = 'â„¹ï¸ ' + d.error;
        return;
      }
      document.getElementById('monCPU').textContent = d.cpu + '%';
      document.getElementById('monCPUBar').style.width = d.cpu + '%';
      document.getElementById('monRAM').textContent = d.ram_pct + '%';
      document.getElementById('monRAMBar').style.width = d.ram_pct + '%';
      document.getElementById('monRAMSub').textContent = d.ram_used + ' / ' + d.ram_total;
      document.getElementById('monSwap').textContent = d.swap_pct + '%';
      document.getElementById('monSwapBar').style.width = d.swap_pct + '%';
      document.getElementById('monSwapSub').textContent = d.swap_used + ' / ' + d.swap_total;
      document.getElementById('monDisk').textContent = d.disk_pct + '%';
      document.getElementById('monDiskBar').style.width = d.disk_pct + '%';
      document.getElementById('monDiskSub').textContent = 'Szabad: ' + d.disk_free;
      document.getElementById('monNetSent').textContent = d.net_sent;
      document.getElementById('monNetRecv').textContent = d.net_recv;
      document.getElementById('monTs').textContent = 'FrissÃ­tve: ' + d.ts;
      document.getElementById('navCPU').textContent = d.cpu + '%';
      // Processes
      const tbody = document.getElementById('procBody');
      if (d.processes && d.processes.length) {
        tbody.innerHTML = d.processes.map(p => `
          <tr>
            <td style="color:var(--text2)">${p.pid}</td>
            <td>${p.name}</td>
            <td style="color:var(--accent2)">${p.mem_pct}%</td>
            <td style="color:var(--accent)">${p.cpu_pct}%</td>
          </tr>`).join('');
      }
    } catch(e) {}
  };
}
function stopMonitor() {
  if (monitorES) { monitorES.close(); monitorES = null; }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ANALYZER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function runAnalyzer() {
  document.getElementById('analyzerContent').innerHTML = '<div style="color:var(--text2);font-size:10px;padding:20px">ElemzÃ©s...</div>';
  const res = await fetch('/api/disk_usage');
  const data = await res.json();
  if (!data.length) { document.getElementById('analyzerContent').innerHTML = '<div style="padding:20px;color:var(--text2)">Nem talÃ¡lhatÃ³k mappÃ¡k.</div>'; return; }
  const max = data[0].size;
  let html = '<div class="card">';
  data.forEach(item => {
    const pct = max > 0 ? (item.size/max*100) : 0;
    html += `<div class="disk-item">
      <div><div class="disk-name">${item.name}</div><div class="disk-path">${item.path}</div></div>
      <div class="disk-bar-bg"><div class="disk-bar-fill" style="width:${pct}%"></div></div>
      <div class="disk-sz">${item.size_fmt}</div>
    </div>`;
  });
  html += '</div>';
  document.getElementById('analyzerContent').innerHTML = html;
  addLog('Lemez elemzÃ©s kÃ©sz', 'ok');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LARGE FILES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function runLargeFiles() {
  const path = document.getElementById('lfPath').value;
  const minMB = parseInt(document.getElementById('lfMinMB').value) || 50;
  document.getElementById('lfResults').innerHTML = '<div style="color:var(--text2);padding:20px;font-size:10px;animation:blink 1s infinite">ğŸ” KeresÃ©s...</div>';
  addLog(`Nagy fÃ¡jlok: ${path}, min. ${minMB} MB`, 'info');
  try {
    const res = await fetch('/api/large_files', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({path, min_size_mb: minMB}) });
    const data = await res.json();
    if (!data.length) { document.getElementById('lfResults').innerHTML = `<div style="padding:20px;color:var(--text2);font-size:11px">Nem talÃ¡lhatÃ³k ${minMB} MB-nÃ¡l nagyobb fÃ¡jlok.</div>`; return; }
    const extC = {'.mp4':'#ff6b35','.mkv':'#ff6b35','.avi':'#ff6b35','.iso':'#ffb830','.zip':'#ffb830','.rar':'#ffb830','.exe':'#00c8f0','.msi':'#00c8f0','.psd':'#c87fff','.db':'#5eff6e'};
    let html = `<div class="card" style="padding:0"><div style="padding:10px 12px;font-size:9px;color:var(--text2);border-bottom:1px solid var(--border)">${data.length} fÃ¡jl (${minMB} MB felett)</div>`;
    data.forEach(f => {
      const c = extC[f.ext] || 'var(--text2)';
      html += `<div class="lf-row">
        <div><div class="lf-name" title="${f.path}">${f.name}</div><div class="lf-fp">${f.path}</div></div>
        <div class="lf-sz">${f.size_fmt}</div>
        <div class="ext-badge" style="color:${c};border-color:${c}40">${f.ext||'?'}</div>
        <button class="del-btn" onclick="deleteFile('${f.path.replace(/\\/g,'\\\\').replace(/'/g,"\\'")}', this)" title="TÃ¶rlÃ©s">ğŸ—‘ï¸</button>
      </div>`;
    });
    html += '</div>';
    document.getElementById('lfResults').innerHTML = html;
    addLog(`Nagy fÃ¡jlok: ${data.length} talÃ¡lat`, 'ok');
  } catch(e) {
    document.getElementById('lfResults').innerHTML = `<div style="color:var(--danger);padding:20px;font-size:10px">Hiba: ${e}</div>`;
  }
}

async function deleteFile(path, btn) {
  if (!confirm('Biztosan tÃ¶rÃ¶lni szeretnÃ©d?\n' + path)) return;
  const res = await fetch('/api/delete_file', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({path}) });
  const d = await res.json();
  if (d.ok) { btn.closest('.lf-row').remove(); toast('FÃ¡jl tÃ¶rÃ¶lve', 'ok'); addLog('TÃ¶rÃ¶lve: ' + path, 'ok'); }
  else toast('Hiba: ' + d.error, 'err');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DUPLICATES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function runDuplicates() {
  const path = document.getElementById('dupPath').value;
  const minKB = parseInt(document.getElementById('dupMinKB').value) || 10;
  document.getElementById('dupWarning').style.display = 'block';
  document.getElementById('dupSummary').style.display = 'none';
  document.getElementById('dupResults').innerHTML = '<div style="color:var(--text2);padding:20px;font-size:10px;animation:blink 1s infinite">ğŸ” MD5 hash szÃ¡mÃ­tÃ¡s folyamatban... (lassabb lehet nagy mappÃ¡kon)</div>';
  addLog(`DuplikÃ¡tum keresÃ©s: ${path}`, 'info');
  try {
    const res = await fetch('/api/duplicates', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({path, min_size_kb: minKB}) });
    const data = await res.json();
    document.getElementById('navDup').textContent = data.total_groups || 'â€”';
    if (!data.groups.length) {
      document.getElementById('dupResults').innerHTML = '<div style="padding:20px;color:var(--text2);font-size:11px">âœ… Nem talÃ¡lhatÃ³k duplikÃ¡lt fÃ¡jlok.</div>';
      return;
    }
    const sum = document.getElementById('dupSummary');
    sum.style.display = 'block';
    sum.innerHTML = `<div class="result-grid">
      <div class="result-card"><div class="result-num" style="color:var(--warn)">${data.total_groups}</div><div class="result-lbl">DuplikÃ¡lt csoport</div></div>
      <div class="result-card"><div class="result-num" style="color:var(--danger)">${data.total_wasted}</div><div class="result-lbl">Felesleges hely</div></div>
    </div>`;
    let html = '';
    data.groups.forEach((g, gi) => {
      html += `<div class="dup-group">
        <div class="dup-header" onclick="this.nextElementSibling.style.display=this.nextElementSibling.style.display==='none'?'block':'none'">
          <span style="font-size:10px;color:var(--text2)">${g.files.length} azonos fÃ¡jl</span>
          <span class="dup-hash">${g.hash.substring(0,12)}â€¦</span>
          <span class="dup-waste">ğŸ—‘ ${g.wasted}</span>
        </div>
        <div class="dup-files" style="display:none">
          ${g.files.map((f,fi) => `<div class="dup-file">
            <span style="font-size:9px;padding:1px 5px;background:${fi===0?'rgba(0,200,240,.15)':'rgba(255,62,94,.1)'};border-radius:2px;color:${fi===0?'var(--accent)':'var(--danger)'};flex-shrink:0">${fi===0?'ORIG':'MÃSOL'}</span>
            <span class="dup-path" title="${f.path}">${f.path}</span>
            <span class="dup-sz">${f.size_fmt}</span>
            ${fi>0?`<button class="del-btn" onclick="deleteFile('${f.path.replace(/\\/g,'\\\\').replace(/'/g,"\\'")}',this.closest('.dup-file'))" title="MÃ¡solat tÃ¶rlÃ©se">ğŸ—‘ï¸</button>`:''}
          </div>`).join('')}
        </div>
      </div>`;
    });
    document.getElementById('dupResults').innerHTML = html;
    addLog(`DuplikÃ¡tum keresÃ©s kÃ©sz: ${data.total_groups} csoport, ${data.total_wasted} vesztesÃ©g`, 'ok');
    toast(`${data.total_groups} duplikÃ¡lt csoport â€” ${data.total_wasted} felesleges hely`, 'warn', 6000);
  } catch(e) {
    document.getElementById('dupResults').innerHTML = `<div style="color:var(--danger);padding:20px">Hiba: ${e}</div>`;
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// REGISTRY
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function runRegScan() {
  document.getElementById('regStatus').style.display = 'none';
  document.getElementById('regResults').innerHTML = '<div style="color:var(--text2);font-size:10px;padding:20px;animation:blink 1s infinite">ğŸ” Registry beolvasÃ¡s...</div>';
  const res = await fetch('/api/registry/scan');
  const data = await res.json();
  regIssues = data.issues || [];
  document.getElementById('navReg').textContent = regIssues.length || '0';

  if (!regIssues.length) {
    document.getElementById('regResults').innerHTML = '<div style="padding:20px;color:var(--accent3);font-size:11px">âœ… Nem talÃ¡lhatÃ³k registry problÃ©mÃ¡k!</div>';
    return;
  }
  if (data.system !== 'Windows') {
    document.getElementById('regResults').innerHTML = `<div style="padding:20px;font-size:11px;color:var(--warn)">âš ï¸ Registry tisztÃ­tÃ¡s csak Windows rendszeren elÃ©rhetÅ‘ (jelenlegi: ${data.system}).<br><br>Windows rendszeren ez a funkciÃ³ az alÃ¡bbi elemeket keresi:<br>â€¢ HiÃ¡nyzÃ³ telepÃ­tÃ©si mappÃ¡k<br>â€¢ Elavult autostart bejegyzÃ©sek<br>â€¢ Felesleges MUI cache bejegyzÃ©sek<br>â€¢ RÃ©gi dokumentum elÅ‘zmÃ©nyek</div>`;
    return;
  }
  document.getElementById('regCleanAllBtn').style.display = 'inline-flex';
  const typeIco = { missing_install:'ğŸ“¦', startup_missing:'ğŸš€', mui_cache:'ğŸ—‚ï¸', recent_docs:'ğŸ“„', error:'âŒ', info:'â„¹ï¸' };
  const typeColor = { missing_install:'var(--warn)', startup_missing:'var(--danger)', mui_cache:'var(--accent2)', recent_docs:'var(--text2)' };
  let html = '';
  regIssues.forEach((issue, i) => {
    const c = typeColor[issue.type] || 'var(--text2)';
    html += `<div class="reg-item" id="reg-item-${i}">
      <div class="reg-ico">${typeIco[issue.type]||'ğŸ”§'}</div>
      <div class="reg-info">
        <div class="reg-desc">${issue.description}</div>
        <div class="reg-path" title="${issue.path}">${issue.path}</div>
        ${issue.detail?`<div style="font-size:8px;color:var(--text2);margin-top:2px">${issue.detail}</div>`:''}
      </div>
      <span class="reg-type" style="color:${c};border-color:${c}40">${issue.type}</span>
      ${issue.type!=='info'&&issue.type!=='error'?`<button class="btn btn-w btn-sm" onclick="cleanRegItem(${i})">JavÃ­t</button>`:''}
    </div>`;
  });
  document.getElementById('regResults').innerHTML = html;
  addLog(`Registry: ${regIssues.length} problÃ©ma`, regIssues.length > 0 ? 'warn' : 'ok');
  toast(`Registry: ${regIssues.length} problÃ©mÃ¡t talÃ¡ltam`, regIssues.length > 0 ? 'warn' : 'ok');
}

async function cleanRegItem(idx) {
  const issue = regIssues[idx];
  if (!confirm(`JavÃ­tod ezt a registry bejegyzÃ©st?\n\n${issue.description}\n${issue.path}`)) return;
  const res = await fetch('/api/registry/clean', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({path:issue.path, type:issue.type}) });
  const d = await res.json();
  if (d.ok) {
    document.getElementById('reg-item-'+idx).remove();
    toast('Registry bejegyzÃ©s javÃ­tva', 'ok');
    addLog('Registry javÃ­tva: ' + issue.path, 'ok');
  } else toast('Hiba a javÃ­tÃ¡s sorÃ¡n', 'err');
}

async function cleanAllRegistry() {
  if (!confirm(`JavÃ­tod az Ã¶sszes (${regIssues.length}) registry problÃ©mÃ¡t?`)) return;
  for (let i = 0; i < regIssues.length; i++) {
    await fetch('/api/registry/clean', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({path:regIssues[i].path, type:regIssues[i].type}) });
    const el = document.getElementById('reg-item-'+i);
    if (el) el.remove();
  }
  toast('Ã–sszes registry problÃ©ma javÃ­tva', 'ok');
  addLog('Registry: Ã¶sszes javÃ­tva', 'ok');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SYSTEM INFO
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function loadSysInfo() {
  const res = await fetch('/api/system_info');
  const d = await res.json();
  document.getElementById('sysOS').textContent  = d.os || 'â€”';
  document.getElementById('sysCPU').textContent = d.processor || 'â€”';
  document.getElementById('sysHost').textContent= d.hostname || 'â€”';
  document.getElementById('sysDT').textContent  = d.disk_total || 'â€”';
  document.getElementById('sysDU').textContent  = d.disk_used  || 'â€”';
  document.getElementById('sysDF').textContent  = d.disk_free  || 'â€”';
  document.getElementById('sysBadge').textContent = d.os || 'â€”';
  drawDonut(d.disk_pct||0, d.disk_free, d.disk_used, d.disk_total);
}

function drawDonut(pct, free, used, total) {
  const c = document.getElementById('diskChart');
  if (!c) return;
  const ctx = c.getContext('2d');
  c.width=100; c.height=100;
  const cx=50,cy=50,r=40,lw=10;
  ctx.beginPath(); ctx.arc(cx,cy,r,0,Math.PI*2); ctx.strokeStyle='#1a2535'; ctx.lineWidth=lw; ctx.stroke();
  if (pct > 0) {
    const g = ctx.createLinearGradient(0,0,100,0);
    g.addColorStop(0,'#00c8f0'); g.addColorStop(1,'#ff6b35');
    ctx.beginPath(); ctx.arc(cx,cy,r,-Math.PI/2,-Math.PI/2+(pct/100)*Math.PI*2);
    ctx.strokeStyle=g; ctx.lineWidth=lw; ctx.lineCap='round'; ctx.stroke();
  }
  ctx.fillStyle='#c0d0e0'; ctx.font='bold 14px Orbitron,monospace';
  ctx.textAlign='center'; ctx.textBaseline='middle'; ctx.fillText(pct+'%',cx,cy);
  document.getElementById('diskLegend').innerHTML=`
    <div class="leg-row"><div class="leg-dot" style="background:#1a2535;border:1px solid #243040"></div><div class="leg-lbl">Szabad</div><div class="leg-val">${free||'â€”'}</div></div>
    <div class="leg-row"><div class="leg-dot" style="background:linear-gradient(90deg,#00c8f0,#ff6b35)"></div><div class="leg-lbl">HasznÃ¡lt</div><div class="leg-val">${used||'â€”'}</div></div>
    <div class="leg-row"><div class="leg-dot" style="background:#243040"></div><div class="leg-lbl">Ã–sszesen</div><div class="leg-val">${total||'â€”'}</div></div>`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SCHEDULE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function loadScheduleUI() {
  const res = await fetch('/api/schedule');
  const s = await res.json();
  const tog = document.getElementById('schedToggle');
  tog.classList.toggle('on', s.enabled);
  document.getElementById('schedInterval').value = s.interval_hours || 24;
  if (s.categories) {
    ['temp','browser','logs','thumbnails'].forEach(c => {
      const el = document.getElementById('scat-'+c);
      if (el) el.checked = s.categories.includes(c);
    });
  }
  document.getElementById('schedLastRun').textContent = s.last_run || 'Soha';
  document.getElementById('navSched').textContent = s.enabled ? 'ON' : 'OFF';
  document.getElementById('navSched').classList.toggle('ok', s.enabled);
}

function toggleSched() {
  document.getElementById('schedToggle').classList.toggle('on');
}

async function saveSched() {
  const cats = ['temp','browser','logs','thumbnails'].filter(c => {
    const el = document.getElementById('scat-'+c); return el && el.checked;
  });
  const s = {
    enabled: document.getElementById('schedToggle').classList.contains('on'),
    interval_hours: parseInt(document.getElementById('schedInterval').value),
    categories: cats,
  };
  await fetch('/api/schedule', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(s) });
  toast('ÃœtemezÅ‘ beÃ¡llÃ­tva', 'ok');
  addLog('ÃœtemezÅ‘: ' + (s.enabled ? 'bekapcsolva' : 'kikapcsolva'), 'info');
  loadScheduleUI();
}

async function runNow() {
  toast('Azonnali tisztÃ­tÃ¡s indÃ­tva...', 'info');
  const cats = ['temp','browser','logs','thumbnails'].filter(c => {
    const el = document.getElementById('scat-'+c); return el && el.checked;
  });
  const res = await fetch('/api/clean', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({categories:cats, min_age_days:0}) });
  const d = await res.json();
  toast(`âœ… ${d.total_freed} felszabadÃ­tva`, 'ok', 5000);
  addLog('Azonnali futtatÃ¡s kÃ©sz: ' + d.total_freed, 'ok');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BACKUPS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function loadBackups() {
  const res = await fetch('/api/backups');
  const data = await res.json();
  document.getElementById('navBk').textContent = data.length;
  const el = document.getElementById('backupList');
  if (!data.length) { el.innerHTML = '<div style="padding:20px;text-align:center;color:var(--text2);font-size:11px">MÃ©g nincs biztonsÃ¡gi mentÃ©s. Az elsÅ‘ tisztÃ­tÃ¡s utÃ¡n keletkeznek.</div>'; return; }
  let html = data.map(b => `<div class="bk-row">
    <div class="bk-name">ğŸ“¦ ${b.name}</div>
    <div class="bk-date">${b.date}</div>
    <div class="bk-sz">${b.size}</div>
    <a href="${b.url}" class="btn btn-s btn-sm">â¬‡ LetÃ¶lt</a>
    <button class="btn btn-d btn-sm" onclick="deleteBackup('${b.name}')">ğŸ—‘ï¸</button>
  </div>`).join('');
  el.innerHTML = html;
}

async function deleteBackup(name) {
  if (!confirm('TÃ¶rlÃ¶d ezt a backupot?\n' + name)) return;
  await fetch('/api/backups/delete', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({name}) });
  toast('Backup tÃ¶rÃ¶lve', 'ok');
  loadBackups();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// HISTORY
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function loadHistory() {
  const res = await fetch('/api/history');
  const data = await res.json();
  document.getElementById('navHist').textContent = data.length;
  if (!data.length) {
    document.getElementById('histContent').innerHTML = '<div style="padding:20px;color:var(--text2);font-size:11px">MÃ©g nincs elÅ‘zmÃ©ny.</div>';
    return;
  }
  const totalFreed = data.reduce((a,e) => a + (e.total_freed_bytes||0), 0);
  let html = `<div class="result-grid" style="margin-bottom:16px">
    <div class="result-card"><div class="result-num" style="color:var(--accent)">${data.length}</div><div class="result-lbl">Ã–sszes tisztÃ­tÃ¡s</div></div>
    <div class="result-card"><div class="result-num" style="color:var(--accent3)">${fmtB(totalFreed)}</div><div class="result-lbl">Ã–sszes felszabadÃ­tva</div></div>
    <div class="result-card"><div class="result-num" style="color:var(--warn)">${data.filter(e=>e.auto).length}</div><div class="result-lbl">Auto futtatÃ¡s</div></div>
  </div>`;
  data.forEach(e => {
    const cats = (e.categories||[]).join(', ');
    html += `<div class="hist-item">
      <div><div class="hist-ts">${e.timestamp} ${e.auto?'âš™ï¸ Auto':''}</div><div class="hist-cats">${cats}</div></div>
      <div class="hist-freed">${e.total_freed}</div>
      <div><div style="color:var(--accent);font-size:11px">${e.total_files} fÃ¡jl</div>
           ${e.backup?`<div style="font-size:8px;color:var(--accent3);margin-top:2px">ğŸ’¾ backup</div>`:''}
      </div>
    </div>`;
  });
  document.getElementById('histContent').innerHTML = html;
}

async function clearHistory() {
  if (!confirm('TÃ¶rlÃ¶d az Ã¶sszes elÅ‘zmÃ©nyt?')) return;
  await fetch('/api/history/clear', {method:'POST'});
  loadHistory(); toast('ElÅ‘zmÃ©nyek tÃ¶rÃ¶lve', 'info');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CONFIG / SETTINGS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function loadConfig() {
  const res = await fetch('/api/config');
  _config = await res.json();
  // Populate profile select
  const sel = document.getElementById('profileSel');
  sel.innerHTML = '';
  Object.entries(_config.profiles||{}).forEach(([id, p]) => {
    const opt = document.createElement('option');
    opt.value = id; opt.textContent = p.name || id;
    if (id === _config.active_profile) opt.selected = true;
    sel.appendChild(opt);
  });
  // Update custom dirs on cleaner page
  const profile = _config.profiles[_config.active_profile] || {};
  const dirs = profile.custom_dirs || [];
  document.getElementById('customDirsDesc').textContent = dirs.length ? dirs.join(', ') : 'Nincs egyÃ©ni mappa â€” Ã¡llÃ­tsd be a BeÃ¡llÃ­tÃ¡sokban';
}

function loadSettingsUI() {
  if (!_config) return;
  const pid = _config.active_profile || 'default';
  const profile = _config.profiles[pid] || {};
  document.getElementById('cfgProfileName').value = profile.name || '';
  document.getElementById('cfgPassword').value = '';
  document.getElementById('cfgBackupMB').value = profile.backup_max_mb || 200;
  const ab = document.getElementById('cfgAutoBackup');
  if (profile.auto_backup !== false) ab.classList.add('on'); else ab.classList.remove('on');
  // Custom dirs
  renderCustomDirs(profile.custom_dirs || []);
}

let _customDirs = [];
function renderCustomDirs(dirs) {
  _customDirs = [...dirs];
  const container = document.getElementById('customDirTags');
  container.innerHTML = _customDirs.map((d,i) => `
    <span class="dir-tag">${d}<span class="rm" onclick="removeDir(${i})">âœ•</span></span>`).join('');
}
function removeDir(i) { _customDirs.splice(i,1); renderCustomDirs(_customDirs); }
function addCustomDir() {
  const val = document.getElementById('newDirInput').value.trim();
  if (val && !_customDirs.includes(val)) {
    _customDirs.push(val); renderCustomDirs(_customDirs);
    document.getElementById('newDirInput').value = '';
  }
}

async function saveSettings() {
  const name = document.getElementById('cfgProfileName').value;
  const pw   = document.getElementById('cfgPassword').value;
  const bmb  = parseInt(document.getElementById('cfgBackupMB').value);
  const ab   = document.getElementById('cfgAutoBackup').classList.contains('on');
  const update = { name, backup_max_mb: bmb, auto_backup: ab, custom_dirs: _customDirs };
  if (pw && pw !== '***') update.password = pw;
  await fetch('/api/config', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({profile_update: update}) });
  toast('BeÃ¡llÃ­tÃ¡sok mentve', 'ok'); addLog('BeÃ¡llÃ­tÃ¡sok mentve', 'ok');
  await loadConfig();
}

async function createProfile() {
  const name = document.getElementById('newProfileName').value.trim();
  if (!name) return;
  const id = name.toLowerCase().replace(/\s+/g,'_').replace(/[^\w]/g,'');
  await fetch('/api/config', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({new_profile:{id, name}}) });
  toast('Ãšj profil: ' + name, 'ok');
  document.getElementById('newProfileName').value = '';
  await loadConfig(); loadSettingsUI();
}

async function deleteProfile() {
  if (!confirm('TÃ¶rlÃ¶d az aktÃ­v profilt? (az "default" nem tÃ¶rÃ¶lhetÅ‘)')) return;
  await fetch('/api/config', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({delete_profile: _config.active_profile}) });
  toast('Profil tÃ¶rÃ¶lve', 'info'); await loadConfig(); loadSettingsUI();
}

async function switchProfile(id) {
  const cfg = await (await fetch('/api/config')).json();
  const profile = cfg.profiles[id] || {};
  if (profile.password && profile.password !== '') {
    document.getElementById('pwModal').classList.add('visible');
    document.getElementById('pwModal').dataset.profile = id;
  } else {
    await fetch('/api/config', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({active_profile: id}) });
    await loadConfig(); toast('Profil: ' + (profile.name||id), 'info');
  }
}

async function submitPassword() {
  const id  = document.getElementById('pwModal').dataset.profile;
  const pwd = document.getElementById('pwInput').value;
  const res = await fetch('/api/config/verify_password', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({profile_id: id, password: pwd}) });
  const d = await res.json();
  if (d.ok) {
    await fetch('/api/config', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({active_profile: id}) });
    closePwModal(); await loadConfig(); toast('BelÃ©pÃ©s sikeres', 'ok');
  } else { toast('Helytelen jelszÃ³!', 'err'); document.getElementById('pwInput').value = ''; }
}

function closePwModal() {
  document.getElementById('pwModal').classList.remove('visible');
  document.getElementById('pwInput').value = '';
}

document.getElementById('pwInput').addEventListener('keydown', e => { if (e.key === 'Enter') submitPassword(); });

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// UTILS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function fmtB(n) {
  if (!n) return '0 B';
  if (n < 1024) return n + ' B';
  if (n < 1024**2) return (n/1024).toFixed(1) + ' KB';
  if (n < 1024**3) return (n/1024**2).toFixed(1) + ' MB';
  return (n/1024**3).toFixed(2) + ' GB';
}
</script>
</body>
</html>
