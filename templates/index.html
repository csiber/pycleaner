<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PyCleaner ‚Äî Rendszertiszt√≠t√≥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="/static/favicon.png">
  <link rel="apple-touch-icon" href="/static/icon-192.png">
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=IBM+Plex+Mono:wght@300;400;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #080a0e;
      --surface: #0d1117;
      --surface2: #131b24;
      --border: #1a2535;
      --border2: #243040;
      --accent: #00c8f0;
      --accent2: #ff6b35;
      --accent3: #5eff6e;
      --danger: #ff3e5e;
      --warn: #ffb830;
      --text: #c0d0e0;
      --text2: #506070;
      --glow: 0 0 24px rgba(0,200,240,0.2);
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'IBM Plex Mono', monospace;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
    }

    body::before {
      content: '';
      position: fixed; inset: 0;
      background-image:
        linear-gradient(rgba(0,200,240,0.025) 1px, transparent 1px),
        linear-gradient(90deg, rgba(0,200,240,0.025) 1px, transparent 1px);
      background-size: 44px 44px;
      pointer-events: none; z-index: 0;
    }

    .app {
      position: relative; z-index: 1;
      display: grid;
      grid-template-columns: 240px 1fr;
      grid-template-rows: 60px 1fr;
      min-height: 100vh;
    }

    /* ---- HEADER ---- */
    header {
      grid-column: 1/-1;
      display: flex; align-items: center; gap: 14px;
      padding: 0 20px;
      background: rgba(8,10,14,0.97);
      border-bottom: 1px solid var(--border);
      backdrop-filter: blur(12px);
      position: sticky; top: 0; z-index: 100;
    }

    .logo {
      font-family: 'Orbitron', sans-serif;
      font-size: 18px; font-weight: 900;
      color: var(--accent); letter-spacing: 3px;
      text-shadow: 0 0 20px rgba(0,200,240,0.4);
    }
    .logo span { color: var(--accent2); }

    .ver-badge {
      font-size: 9px; background: rgba(0,200,240,0.12);
      color: var(--accent); padding: 2px 7px;
      border: 1px solid rgba(0,200,240,0.3); border-radius: 2px;
      letter-spacing: 1.5px;
    }

    .header-right { margin-left: auto; display: flex; align-items: center; gap: 10px; }

    .sys-badge {
      font-size: 10px; color: var(--text2);
      padding: 4px 10px; border: 1px solid var(--border);
      border-radius: 2px; background: var(--surface);
    }

    /* ---- SIDEBAR ---- */
    nav {
      background: var(--surface);
      border-right: 1px solid var(--border);
      padding: 16px 0;
      display: flex; flex-direction: column;
    }

    .nav-sec {
      padding: 10px 16px 4px;
      font-size: 8px; letter-spacing: 2.5px;
      color: var(--text2); text-transform: uppercase;
    }

    .nav-item {
      display: flex; align-items: center; gap: 10px;
      padding: 10px 18px; cursor: pointer;
      border-left: 3px solid transparent;
      font-size: 11px; color: var(--text2);
      transition: all 0.15s; user-select: none;
    }

    .nav-item:hover { background: rgba(0,200,240,0.05); color: var(--text); }
    .nav-item.active { background: rgba(0,200,240,0.07); border-left-color: var(--accent); color: var(--accent); }

    .nav-icon { font-size: 15px; width: 18px; text-align: center; }

    .nav-pill {
      margin-left: auto; font-size: 9px;
      padding: 1px 6px; border-radius: 2px;
      background: var(--surface2); border: 1px solid var(--border2);
      color: var(--text2); white-space: nowrap;
    }
    .nav-pill.warn { border-color: var(--warn); color: var(--warn); }
    .nav-pill.ok { border-color: var(--accent3); color: var(--accent3); }

    .nav-div { height: 1px; background: var(--border); margin: 8px 14px; }

    /* ---- MAIN ---- */
    main {
      padding: 24px;
      overflow-y: auto;
      background: var(--bg);
    }

    .page { display: none; animation: fadeIn 0.2s; }
    .page.active { display: block; }

    @keyframes fadeIn { from{opacity:0;transform:translateY(4px)} to{opacity:1;transform:none} }

    .page-title {
      font-family: 'Orbitron', sans-serif;
      font-size: 20px; font-weight: 700;
      color: var(--text); margin-bottom: 4px;
    }

    .page-sub { font-size: 10px; color: var(--text2); margin-bottom: 22px; letter-spacing: 1px; }

    /* ---- CARDS ---- */
    .grid-3 { display: grid; grid-template-columns: repeat(3,1fr); gap: 14px; margin-bottom: 20px; }
    .grid-2 { display: grid; grid-template-columns: repeat(2,1fr); gap: 14px; }

    .card {
      background: var(--surface); border: 1px solid var(--border);
      border-radius: 4px; padding: 18px;
      transition: border-color 0.2s;
    }
    .card:hover { border-color: var(--border2); }

    .card-hdr { display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px; }
    .card-lbl { font-size: 10px; letter-spacing: 1.5px; color: var(--text2); text-transform: uppercase; }
    .card-ico { font-size: 18px; }

    .stat { font-family: 'Orbitron', sans-serif; font-size: 22px; font-weight: 700; color: var(--accent); }
    .stat-sub { font-size: 10px; color: var(--text2); margin-top: 3px; }

    /* ---- CLEANER ITEMS ---- */
    .cleaner-items { display: flex; flex-direction: column; gap: 10px; margin-bottom: 18px; }

    .cleaner-item {
      background: var(--surface); border: 1px solid var(--border);
      border-radius: 4px; padding: 14px 18px;
      display: flex; align-items: center; gap: 14px;
      cursor: pointer; transition: all 0.15s;
    }
    .cleaner-item:hover { border-color: var(--border2); background: var(--surface2); }
    .cleaner-item.selected { border-color: var(--accent); background: rgba(0,200,240,0.05); }

    .chk {
      width: 16px; height: 16px; border: 2px solid var(--border2);
      border-radius: 2px; display: flex; align-items: center;
      justify-content: center; flex-shrink: 0; font-size: 10px;
      transition: all 0.15s;
    }
    .cleaner-item.selected .chk { border-color: var(--accent); background: var(--accent); color: #000; }

    .ci-info { flex: 1; }
    .ci-name { font-size: 12px; font-weight: 600; color: var(--text); margin-bottom: 2px; }
    .ci-desc { font-size: 10px; color: var(--text2); }

    .ci-size { text-align: right; flex-shrink: 0; min-width: 70px; }
    .ci-val { font-family: 'Orbitron', sans-serif; font-size: 13px; color: var(--accent2); }
    .ci-files { font-size: 10px; color: var(--text2); margin-top: 2px; }
    .ci-scanning { font-size: 10px; color: var(--text2); animation: blink 1s infinite; }

    @keyframes blink { 0%,100%{opacity:1}50%{opacity:0.3} }

    /* ---- ACTION BAR ---- */
    .action-bar {
      display: flex; flex-wrap: wrap; align-items: center; gap: 10px;
      padding: 16px 18px;
      background: var(--surface); border: 1px solid var(--border);
      border-radius: 4px; margin-bottom: 14px;
    }

    .age-filter { display: flex; align-items: center; gap: 8px; margin-left: 4px; }
    .age-filter label { font-size: 10px; color: var(--text2); }
    .age-select {
      background: var(--surface2); border: 1px solid var(--border2);
      color: var(--text); font-family: 'IBM Plex Mono', monospace;
      font-size: 10px; padding: 4px 8px; border-radius: 2px; cursor: pointer;
    }

    .action-total { margin-left: auto; text-align: right; }
    .total-lbl { font-size: 9px; color: var(--text2); letter-spacing: 1px; text-transform: uppercase; }
    .total-val { font-family: 'Orbitron', sans-serif; font-size: 16px; color: var(--accent2); }

    /* ---- BUTTONS ---- */
    .btn {
      display: inline-flex; align-items: center; gap: 6px;
      padding: 8px 18px; border: none; border-radius: 3px;
      font-family: 'IBM Plex Mono', monospace; font-size: 11px;
      font-weight: 600; letter-spacing: 1px; cursor: pointer;
      transition: all 0.15s; text-transform: uppercase; white-space: nowrap;
    }
    .btn-primary { background: var(--accent); color: #000; }
    .btn-primary:hover { box-shadow: 0 0 18px rgba(0,200,240,0.4); filter: brightness(1.1); }
    .btn-danger { background: var(--danger); color: #fff; }
    .btn-danger:hover { box-shadow: 0 0 18px rgba(255,62,94,0.4); filter: brightness(1.1); }
    .btn-sec { background: transparent; color: var(--text2); border: 1px solid var(--border2); }
    .btn-sec:hover { border-color: var(--text2); color: var(--text); }
    .btn-warn { background: var(--warn); color: #000; }
    .btn-warn:hover { filter: brightness(1.1); }
    .btn:disabled { opacity: 0.35; cursor: not-allowed; filter: none !important; box-shadow: none !important; }

    /* ---- PROGRESS ---- */
    .progress-wrap { display: none; background: var(--surface); border: 1px solid var(--border); border-radius: 4px; padding: 16px; margin-bottom: 14px; }
    .progress-wrap.visible { display: block; }
    .prog-lbl { font-size: 11px; color: var(--text2); margin-bottom: 8px; }
    .prog-bg { height: 3px; background: var(--border); border-radius: 2px; overflow: hidden; }
    .prog-fill { height: 100%; background: linear-gradient(90deg, var(--accent), var(--accent2)); border-radius: 2px; transition: width 0.3s; }
    .prog-fill.indeterminate { width: 35%; animation: slide 1s linear infinite; }
    @keyframes slide { 0%{transform:translateX(-120%)}100%{transform:translateX(380%)} }

    /* ---- RESULT GRID ---- */
    .result-grid { display: grid; grid-template-columns: repeat(3,1fr); gap: 10px; margin-top: 14px; }
    .result-card { background: var(--surface2); border: 1px solid var(--border); border-radius: 4px; padding: 12px; text-align: center; }
    .result-num { font-family: 'Orbitron', sans-serif; font-size: 20px; font-weight: 700; }
    .result-lbl { font-size: 9px; color: var(--text2); text-transform: uppercase; letter-spacing: 1px; margin-top: 3px; }
    .result-details { margin-top: 12px; font-size: 10px; color: var(--text2); line-height: 1.8; }

    /* ---- LOG ---- */
    .log-box {
      background: var(--surface); border: 1px solid var(--border);
      border-radius: 4px; padding: 12px;
      font-size: 10px; max-height: 160px; overflow-y: auto; line-height: 1.9;
    }
    .log-line { color: var(--text2); }
    .log-line.ok { color: var(--accent3); }
    .log-line.err { color: var(--danger); }
    .log-line.info { color: var(--accent); }
    .log-line.warn { color: var(--warn); }

    /* ---- HISTORY ---- */
    .history-item {
      background: var(--surface); border: 1px solid var(--border);
      border-radius: 4px; padding: 14px 18px; margin-bottom: 10px;
      display: grid; grid-template-columns: 1fr auto auto; gap: 12px; align-items: center;
    }
    .hist-ts { font-size: 10px; color: var(--text2); margin-bottom: 4px; }
    .hist-cats { font-size: 11px; color: var(--text); }
    .hist-freed { font-family: 'Orbitron', sans-serif; font-size: 14px; color: var(--accent3); }
    .hist-files { font-size: 10px; color: var(--text2); }

    /* ---- DISK OVERVIEW ---- */
    .disk-overview {
      display: flex; gap: 24px; align-items: center;
      padding: 18px; background: var(--surface);
      border: 1px solid var(--border); border-radius: 4px; margin-bottom: 18px;
    }
    canvas#diskChart { width: 110px !important; height: 110px !important; }
    .disk-legend { display: flex; flex-direction: column; gap: 9px; flex: 1; }
    .leg-row { display: flex; align-items: center; gap: 9px; font-size: 11px; }
    .leg-dot { width: 9px; height: 9px; border-radius: 50%; flex-shrink: 0; }
    .leg-lbl { color: var(--text2); flex: 1; }
    .leg-val { color: var(--text); font-weight: 600; }

    /* ---- DISK BARS ---- */
    .disk-item {
      display: grid; grid-template-columns: 130px 1fr 80px;
      align-items: center; gap: 12px;
      padding: 9px 0; border-bottom: 1px solid rgba(26,37,53,0.6);
    }
    .disk-item:last-child { border-bottom: none; }
    .disk-name { font-size: 11px; color: var(--text); }
    .disk-path { font-size: 9px; color: var(--text2); margin-top: 1px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
    .disk-bar-bg { height: 5px; background: var(--border); border-radius: 3px; overflow: hidden; }
    .disk-bar-fill { height: 100%; background: linear-gradient(90deg, var(--accent), var(--accent2)); border-radius: 3px; transition: width 0.7s; }
    .disk-sz { text-align: right; font-size: 10px; color: var(--accent2); font-weight: 600; }

    /* ---- LARGE FILES ---- */
    .lf-controls { display: flex; gap: 10px; align-items: center; margin-bottom: 16px; flex-wrap: wrap; }
    .lf-input {
      background: var(--surface2); border: 1px solid var(--border2);
      color: var(--text); font-family: 'IBM Plex Mono', monospace;
      font-size: 11px; padding: 7px 12px; border-radius: 3px; flex: 1; min-width: 200px;
    }
    .lf-input:focus { outline: none; border-color: var(--accent); }
    .lf-row {
      display: grid; grid-template-columns: 1fr 100px 50px;
      align-items: center; gap: 12px;
      padding: 9px 14px; border-bottom: 1px solid var(--border);
      font-size: 11px;
    }
    .lf-row:last-child { border-bottom: none; }
    .lf-row:hover { background: var(--surface2); }
    .lf-name { color: var(--text); overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
    .lf-path { font-size: 9px; color: var(--text2); margin-top: 2px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
    .lf-size { text-align: right; font-family: 'Orbitron', sans-serif; font-size: 12px; color: var(--accent2); }
    .ext-badge { font-size: 9px; padding: 1px 5px; border-radius: 2px; text-align: center; background: var(--surface2); border: 1px solid var(--border2); color: var(--text2); text-transform: uppercase; }

    /* Scrollbar */
    ::-webkit-scrollbar { width: 5px; }
    ::-webkit-scrollbar-track { background: var(--surface); }
    ::-webkit-scrollbar-thumb { background: var(--border2); border-radius: 3px; }

    /* Responsive */
    @media (max-width: 860px) {
      .app { grid-template-columns: 1fr; }
      nav { flex-direction: row; overflow-x: auto; border-right: none; border-bottom: 1px solid var(--border); padding: 0; }
      .nav-item { border-left: none; border-bottom: 3px solid transparent; padding: 12px 12px; white-space: nowrap; }
      .nav-item.active { border-left-color: transparent; border-bottom-color: var(--accent); }
      .nav-sec, .nav-div, .nav-pill { display: none; }
      .grid-3 { grid-template-columns: 1fr 1fr; }
    }
  </style>
</head>
<body>
<div class="app">

  <!-- HEADER -->
  <header>
    <div class="logo">Py<span>Cleaner</span></div>
    <div class="ver-badge">v2.0</div>
    <div class="header-right">
      <div class="sys-badge" id="sysBadge">Bet√∂lt√©s...</div>
    </div>
  </header>

  <!-- SIDEBAR -->
  <nav>
    <div class="nav-sec">Eszk√∂z√∂k</div>
    <div class="nav-item active" data-page="cleaner">
      <span class="nav-icon">üßπ</span> Tiszt√≠t√≥
      <span class="nav-pill warn" id="navClean">‚Äî</span>
    </div>
    <div class="nav-item" data-page="analyzer">
      <span class="nav-icon">üìä</span> Lemez elemz≈ë
    </div>
    <div class="nav-item" data-page="largefiles">
      <span class="nav-icon">üîç</span> Nagy f√°jlok
    </div>
    <div class="nav-div"></div>
    <div class="nav-sec">Rendszer</div>
    <div class="nav-item" data-page="system">
      <span class="nav-icon">üñ•Ô∏è</span> Rendszerinfo
      <span class="nav-pill ok" id="navDisk">‚Äî</span>
    </div>
    <div class="nav-item" data-page="history">
      <span class="nav-icon">üìú</span> El≈ëzm√©nyek
      <span class="nav-pill" id="navHist">0</span>
    </div>
    <div class="nav-item" data-page="log">
      <span class="nav-icon">üìã</span> Napl√≥
    </div>
  </nav>

  <!-- MAIN -->
  <main>

    <!-- ===== CLEANER ===== -->
    <div class="page active" id="page-cleaner">
      <div class="page-title">Rendszertiszt√≠t√≥</div>
      <div class="page-sub">Jel√∂ld ki a tiszt√≠tand√≥ elemeket, majd futtasd a beolvas√°st</div>

      <div class="cleaner-items" id="cleanerItems">
        <div class="cleaner-item selected" data-category="temp">
          <div class="chk">‚úì</div>
          <div class="ci-info">
            <div class="ci-name">üóÇÔ∏è Ideiglenes f√°jlok</div>
            <div class="ci-desc">%TEMP%, %TMP%, %WINDIR%\Temp, /tmp mapp√°k tartalma</div>
          </div>
          <div class="ci-size"><div class="ci-val" id="sz-temp">‚Äî</div><div class="ci-files" id="fc-temp">‚Äî</div></div>
        </div>
        <div class="cleaner-item selected" data-category="browser">
          <div class="chk">‚úì</div>
          <div class="ci-info">
            <div class="ci-name">üåê B√∂ng√©sz≈ë gyors√≠t√≥t√°r</div>
            <div class="ci-desc">Chrome, Firefox, Edge, Brave cache √©s k√≥d cache</div>
          </div>
          <div class="ci-size"><div class="ci-val" id="sz-browser">‚Äî</div><div class="ci-files" id="fc-browser">‚Äî</div></div>
        </div>
        <div class="cleaner-item selected" data-category="logs">
          <div class="chk">‚úì</div>
          <div class="ci-info">
            <div class="ci-name">üìÑ Log f√°jlok</div>
            <div class="ci-desc">Rendszer √©s alkalmaz√°s napl√≥ f√°jlok (.log, .bak, .old, .tmp)</div>
          </div>
          <div class="ci-size"><div class="ci-val" id="sz-logs">‚Äî</div><div class="ci-files" id="fc-logs">‚Äî</div></div>
        </div>
        <div class="cleaner-item selected" data-category="thumbnails">
          <div class="chk">‚úì</div>
          <div class="ci-info">
            <div class="ci-name">üñºÔ∏è B√©lyegk√©p gyors√≠t√≥t√°r</div>
            <div class="ci-desc">Windows Explorer thumbs, Linux ~/.cache/thumbnails</div>
          </div>
          <div class="ci-size"><div class="ci-val" id="sz-thumbnails">‚Äî</div><div class="ci-files" id="fc-thumbnails">‚Äî</div></div>
        </div>
        <div class="cleaner-item" data-category="trash">
          <div class="chk"></div>
          <div class="ci-info">
            <div class="ci-name">üóëÔ∏è Lomt√°r</div>
            <div class="ci-desc">Lomt√°rban l√©v≈ë f√°jlok v√©gleges, visszavonhatatlan t√∂rl√©se</div>
          </div>
          <div class="ci-size"><div class="ci-val" id="sz-trash">‚Äî</div><div class="ci-files" id="fc-trash">‚Äî</div></div>
        </div>
        <div class="cleaner-item" data-category="downloads">
          <div class="chk"></div>
          <div class="ci-info">
            <div class="ci-name">‚¨áÔ∏è Let√∂lt√©sek (csak elemz√©s)</div>
            <div class="ci-desc">~/Downloads mappa m√©rete ‚Äî nem t√∂rli, csak megmutatja</div>
          </div>
          <div class="ci-size"><div class="ci-val" id="sz-downloads">‚Äî</div><div class="ci-files" id="fc-downloads">‚Äî</div></div>
        </div>
      </div>

      <div class="action-bar">
        <button class="btn btn-primary" onclick="runScan()">üîç Beolvas√°s</button>
        <button class="btn btn-danger" id="cleanBtn" onclick="runClean()" disabled>‚ö° Tiszt√≠t√°s</button>
        <button class="btn btn-sec" onclick="selAll()">‚òë √ñsszes</button>
        <button class="btn btn-sec" onclick="selNone()">‚òê Egyik sem</button>
        <div class="age-filter">
          <label>Minimum kor:</label>
          <select class="age-select" id="ageFilter">
            <option value="0">Mindent t√∂r√∂l</option>
            <option value="1">1 napn√°l r√©gebbi</option>
            <option value="7">7 napn√°l r√©gebbi</option>
            <option value="30">30 napn√°l r√©gebbi</option>
          </select>
        </div>
        <div class="action-total">
          <div class="total-lbl">Felszabad√≠that√≥</div>
          <div class="total-val" id="totalFreeable">‚Äî</div>
        </div>
      </div>

      <div class="progress-wrap" id="progressWrap">
        <div class="prog-lbl" id="progLabel">Beolvas√°s...</div>
        <div class="prog-bg"><div class="prog-fill indeterminate" id="progFill"></div></div>
        <div id="resultArea"></div>
      </div>

      <div style="margin-top:12px">
        <div class="log-box" id="cleanerLog">
          <div class="log-line info">[ PyCleaner v2.0 ] K√©sz. Kattints a "Beolvas√°s" gombra.</div>
        </div>
      </div>
    </div>

    <!-- ===== ANALYZER ===== -->
    <div class="page" id="page-analyzer">
      <div class="page-title">Lemez Elemz≈ë</div>
      <div class="page-sub">Felhaszn√°l√≥i mapp√°k m√©rete √©s ar√°nya vizualiz√°lva</div>
      <div id="analyzerContent">
        <div style="text-align:center;padding:40px;color:var(--text2)">
          <div style="font-size:36px;margin-bottom:12px">üìä</div>
          <div style="font-size:12px">Kattints az "Elemz√©s ind√≠t√°sa" gombra</div>
        </div>
      </div>
      <div style="margin-top:14px">
        <button class="btn btn-primary" onclick="runAnalyzer()">üìä Elemz√©s ind√≠t√°sa</button>
      </div>
    </div>

    <!-- ===== LARGE FILES ===== -->
    <div class="page" id="page-largefiles">
      <div class="page-title">Nagy F√°jlok Keres√©se</div>
      <div class="page-sub">Keresd meg a legt√∂bb helyet foglal√≥ f√°jlokat</div>
      <div class="lf-controls">
        <input class="lf-input" id="lfPath" type="text" placeholder="Mappa (pl. C:\Users\csibe)" value="">
        <input class="lf-input" id="lfMinMB" type="number" placeholder="Min. MB" value="50" style="flex:0;width:100px">
        <button class="btn btn-primary" onclick="runLargeFiles()">üîç Keres√©s</button>
      </div>
      <div id="lfResults">
        <div style="text-align:center;padding:30px;color:var(--text2);font-size:12px">M√©g nem futott keres√©s</div>
      </div>
    </div>

    <!-- ===== SYSTEM ===== -->
    <div class="page" id="page-system">
      <div class="page-title">Rendszerinform√°ci√≥</div>
      <div class="page-sub">Az aktu√°lis rendszer √°llapota √©s lemezhaszn√°lat</div>
      <div class="disk-overview">
        <canvas id="diskChart" width="110" height="110"></canvas>
        <div class="disk-legend" id="diskLegend">
          <div style="color:var(--text2);font-size:11px">Bet√∂lt√©s...</div>
        </div>
      </div>
      <div class="grid-3" id="sysCards">
        <div class="card"><div class="card-hdr"><span class="card-lbl">Oper√°ci√≥s rendszer</span><span class="card-ico">üñ•Ô∏è</span></div><div class="stat" style="font-size:13px" id="sysOS">‚Äî</div></div>
        <div class="card"><div class="card-hdr"><span class="card-lbl">Processzor</span><span class="card-ico">‚öôÔ∏è</span></div><div class="stat" style="font-size:12px" id="sysCPU">‚Äî</div></div>
        <div class="card"><div class="card-hdr"><span class="card-lbl">Hostn√©v</span><span class="card-ico">üîå</span></div><div class="stat" style="font-size:13px" id="sysHost">‚Äî</div></div>
        <div class="card"><div class="card-hdr"><span class="card-lbl">Lemez √∂sszesen</span><span class="card-ico">üíæ</span></div><div class="stat" id="sysDT">‚Äî</div></div>
        <div class="card"><div class="card-hdr"><span class="card-lbl">Felhaszn√°lt</span><span class="card-ico">üìà</span></div><div class="stat" style="color:var(--accent2)" id="sysDU">‚Äî</div></div>
        <div class="card"><div class="card-hdr"><span class="card-lbl">Szabad</span><span class="card-ico">‚úÖ</span></div><div class="stat" style="color:var(--accent3)" id="sysDF">‚Äî</div></div>
      </div>
    </div>

    <!-- ===== HISTORY ===== -->
    <div class="page" id="page-history">
      <div class="page-title">Tiszt√≠t√°si El≈ëzm√©nyek</div>
      <div class="page-sub">Az eddigi tiszt√≠t√°sok napl√≥ja √©s statisztik√°i</div>
      <div style="display:flex;gap:10px;margin-bottom:16px">
        <button class="btn btn-primary" onclick="loadHistory()">üîÑ Friss√≠t√©s</button>
        <button class="btn btn-sec" onclick="clearHistory()">üóëÔ∏è El≈ëzm√©nyek t√∂rl√©se</button>
      </div>
      <div id="historyContent">
        <div style="color:var(--text2);font-size:12px;padding:20px">Bet√∂lt√©s...</div>
      </div>
    </div>

    <!-- ===== LOG ===== -->
    <div class="page" id="page-log">
      <div class="page-title">Esem√©nynapl√≥</div>
      <div class="page-sub">Minden PyCleaner m≈±velet napl√≥z√°sa</div>
      <div class="card">
        <div class="log-box" id="eventLog" style="max-height:520px">
          <div class="log-line info">[ PyCleaner ] Esem√©nynapl√≥ elindult.</div>
        </div>
      </div>
      <div style="margin-top:12px">
        <button class="btn btn-sec" onclick="document.getElementById('eventLog').innerHTML='<div class=\'log-line info\'>[ Napl√≥ t√∂r√∂lve ]</div>'">üóëÔ∏è Napl√≥ t√∂rl√©se</button>
      </div>
    </div>

  </main>
</div>

<script>
// ---- NAV ----
document.querySelectorAll('.nav-item').forEach(item => {
  item.addEventListener('click', () => {
    document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    item.classList.add('active');
    document.getElementById('page-' + item.dataset.page).classList.add('active');
    if (item.dataset.page === 'system') loadSysInfo();
    if (item.dataset.page === 'history') loadHistory();
  });
});

// ---- CHECKBOX ----
document.querySelectorAll('.cleaner-item').forEach(item => {
  item.addEventListener('click', () => {
    item.classList.toggle('selected');
    item.querySelector('.chk').textContent = item.classList.contains('selected') ? '‚úì' : '';
    updateTotal();
  });
});

function selAll() {
  document.querySelectorAll('.cleaner-item').forEach(i => {
    i.classList.add('selected');
    i.querySelector('.chk').textContent = '‚úì';
  });
  updateTotal();
}

function selNone() {
  document.querySelectorAll('.cleaner-item').forEach(i => {
    i.classList.remove('selected');
    i.querySelector('.chk').textContent = '';
  });
  updateTotal();
}

function getSelected() {
  return [...document.querySelectorAll('.cleaner-item.selected')].map(i => i.dataset.category);
}

let scanResults = {};

function updateTotal() {
  let total = 0;
  getSelected().forEach(cat => {
    if (scanResults[cat]) total += scanResults[cat].size || 0;
  });
  document.getElementById('totalFreeable').textContent = total > 0 ? fmtB(total) : '‚Äî';
  document.getElementById('navClean').textContent = total > 0 ? fmtB(total) : '‚Äî';
}

// ---- LOG ----
function addLog(msg, type = '') {
  const t = new Date().toLocaleTimeString('hu-HU');
  ['cleanerLog', 'eventLog'].forEach(id => {
    const el = document.getElementById(id);
    if (!el) return;
    const line = document.createElement('div');
    line.className = 'log-line ' + type;
    line.textContent = `[${t}] ${msg}`;
    el.appendChild(line);
    el.scrollTop = 9999;
  });
}

// ---- SCAN ----
async function runScan() {
  const pw = document.getElementById('progressWrap');
  pw.classList.add('visible');
  setProgress('indeterminate', 'Beolvas√°s folyamatban...');
  document.getElementById('resultArea').innerHTML = '';
  document.getElementById('cleanBtn').disabled = true;
  addLog('Beolvas√°s ind√≠tva...', 'info');

  ['temp','browser','logs','thumbnails','trash','downloads'].forEach(cat => {
    const szEl = document.getElementById('sz-' + cat);
    const fcEl = document.getElementById('fc-' + cat);
    if (szEl) szEl.innerHTML = '<span class="ci-scanning">‚Ä¶</span>';
    if (fcEl) fcEl.textContent = '';
  });

  try {
    const res = await fetch('/api/scan', {
      method: 'POST', headers: {'Content-Type':'application/json'},
      body: JSON.stringify({category: 'all'})
    });
    scanResults = await res.json();

    ['temp','browser','logs','thumbnails','trash','downloads'].forEach(cat => {
      const d = scanResults[cat];
      if (!d) return;
      const szEl = document.getElementById('sz-' + cat);
      const fcEl = document.getElementById('fc-' + cat);
      if (szEl) szEl.textContent = d.size_fmt;
      if (fcEl) fcEl.textContent = d.files + ' f√°jl';
    });

    updateTotal();
    setProgress('done', '‚úÖ Beolvas√°s k√©sz');
    document.getElementById('cleanBtn').disabled = false;

    if (scanResults.disk) {
      document.getElementById('navDisk').textContent = scanResults.disk.used_pct + '%';
    }

    let total = 0;
    getSelected().forEach(cat => { if (scanResults[cat]) total += scanResults[cat].size || 0; });
    addLog('Beolvas√°s k√©sz. Felszabad√≠that√≥: ' + fmtB(total), 'ok');

  } catch(e) {
    addLog('Hiba a beolvas√°s sor√°n: ' + e, 'err');
    setProgress('done', '‚ùå Hiba');
  }
}

// ---- CLEAN ----
async function runClean() {
  const selected = getSelected().filter(c => c !== 'downloads'); // downloads is analyze-only
  if (!selected.length) { addLog('Nincs kiv√°lasztott elem!', 'warn'); return; }

  const minAge = parseInt(document.getElementById('ageFilter').value);
  const ageText = minAge > 0 ? ` (${minAge} napn√°l r√©gebbi f√°jlok)` : '';

  if (!confirm(`Biztosan t√∂r√∂lni szeretn√©d a kiv√°lasztott elemeket?\n\nKateg√≥ri√°k: ${selected.join(', ')}${ageText}\n\n‚ö†Ô∏è Ez a m≈±velet NEM vonhat√≥ vissza!`)) return;

  document.getElementById('cleanBtn').disabled = true;
  setProgress('indeterminate', 'Tiszt√≠t√°s folyamatban...');
  document.getElementById('resultArea').innerHTML = '';
  addLog('Tiszt√≠t√°s ind√≠tva: ' + selected.join(', '), 'warn');

  try {
    const res = await fetch('/api/clean', {
      method: 'POST', headers: {'Content-Type':'application/json'},
      body: JSON.stringify({categories: selected, min_age_days: minAge})
    });
    const data = await res.json();

    setProgress('done', '‚úÖ Tiszt√≠t√°s befejezve!');

    document.getElementById('resultArea').innerHTML = `
      <div class="result-grid">
        <div class="result-card">
          <div class="result-num" style="color:var(--accent3)">${data.total_freed}</div>
          <div class="result-lbl">Felszabad√≠tva</div>
        </div>
        <div class="result-card">
          <div class="result-num" style="color:var(--accent)">${data.total_files}</div>
          <div class="result-lbl">T√∂r√∂lt elem</div>
        </div>
        <div class="result-card">
          <div class="result-num" style="color:${data.total_errors > 0 ? 'var(--danger)' : 'var(--accent3)'}">${data.total_errors}</div>
          <div class="result-lbl">Hiba</div>
        </div>
      </div>
      <div class="result-details">${data.details.map(d => `‚ñ∏ ${d.category}: ${d.files} elem, ${d.freed}`).join('<br>')}</div>
    `;

    addLog(`K√©sz! Felszabad√≠tva: ${data.total_freed}, t√∂r√∂lt: ${data.total_files}, hiba: ${data.total_errors}`, 'ok');
    document.getElementById('navHist').textContent = parseInt(document.getElementById('navHist').textContent || 0) + 1;

    // Rescan after 600ms
    setTimeout(runScan, 600);

  } catch(e) {
    addLog('Hiba: ' + e, 'err');
    document.getElementById('cleanBtn').disabled = false;
  }
}

function setProgress(state, label) {
  document.getElementById('progLabel').textContent = label;
  const fill = document.getElementById('progFill');
  if (state === 'indeterminate') {
    fill.className = 'prog-fill indeterminate';
    fill.style.width = '';
  } else {
    fill.className = 'prog-fill';
    fill.style.width = '100%';
  }
}

// ---- ANALYZER ----
async function runAnalyzer() {
  document.getElementById('analyzerContent').innerHTML = '<div style="color:var(--text2);font-size:11px;padding:20px">Elemz√©s folyamatban...</div>';
  const res = await fetch('/api/disk_usage');
  const data = await res.json();

  if (!data.length) {
    document.getElementById('analyzerContent').innerHTML = '<div style="color:var(--text2);padding:20px;font-size:12px">Nem tal√°lhat√≥k mapp√°k.</div>';
    return;
  }

  const maxSize = data[0].size;
  let html = '<div class="card">';
  data.forEach(item => {
    const pct = maxSize > 0 ? (item.size / maxSize * 100) : 0;
    html += `
      <div class="disk-item">
        <div><div class="disk-name">${item.name}</div><div class="disk-path">${item.path}</div></div>
        <div class="disk-bar-bg"><div class="disk-bar-fill" style="width:${pct}%"></div></div>
        <div class="disk-sz">${item.size_fmt}</div>
      </div>`;
  });
  html += '</div>';
  document.getElementById('analyzerContent').innerHTML = html;
  addLog('Lemez elemz√©s k√©sz', 'ok');
}

// ---- LARGE FILES ----
async function runLargeFiles() {
  const path = document.getElementById('lfPath').value || '~';
  const minMB = parseInt(document.getElementById('lfMinMB').value) || 50;
  document.getElementById('lfResults').innerHTML = '<div style="color:var(--text2);font-size:11px;padding:20px;animation:blink 1s infinite">üîç Keres√©s folyamatban... (ez eltarthat egy ideig)</div>';
  addLog(`Nagy f√°jlok keres√©se: ${path}, min. ${minMB} MB`, 'info');

  try {
    const res = await fetch('/api/large_files', {
      method: 'POST', headers: {'Content-Type':'application/json'},
      body: JSON.stringify({path, min_size_mb: minMB})
    });
    const data = await res.json();

    if (!data.length) {
      document.getElementById('lfResults').innerHTML = `<div style="color:var(--text2);font-size:12px;padding:20px">Nem tal√°lhat√≥k ${minMB} MB-n√°l nagyobb f√°jlok.</div>`;
      return;
    }

    const extColors = {
      '.mp4': '#ff6b35', '.mkv': '#ff6b35', '.avi': '#ff6b35',
      '.iso': '#ffb830', '.zip': '#ffb830', '.rar': '#ffb830',
      '.exe': '#00c8f0', '.msi': '#00c8f0',
      '.psd': '#c87fff', '.ai': '#c87fff',
      '.db': '#5eff6e', '.sqlite': '#5eff6e',
    };

    let html = `<div class="card"><div style="font-size:10px;color:var(--text2);margin-bottom:10px">${data.length} f√°jl tal√°lva (${minMB} MB felett)</div>`;
    data.forEach(f => {
      const color = extColors[f.ext] || 'var(--text2)';
      html += `
        <div class="lf-row">
          <div>
            <div class="lf-name" title="${f.path}">${f.name}</div>
            <div class="lf-path">${f.path}</div>
          </div>
          <div class="lf-size">${f.size_fmt}</div>
          <div class="ext-badge" style="color:${color};border-color:${color}40">${f.ext || '?'}</div>
        </div>`;
    });
    html += '</div>';
    document.getElementById('lfResults').innerHTML = html;
    addLog(`Nagy f√°jlok keres√©se k√©sz: ${data.length} tal√°lat`, 'ok');
  } catch(e) {
    document.getElementById('lfResults').innerHTML = `<div style="color:var(--danger);padding:20px;font-size:11px">Hiba: ${e}</div>`;
    addLog('Hiba: ' + e, 'err');
  }
}

// ---- SYSTEM INFO ----
async function loadSysInfo() {
  const res = await fetch('/api/system_info');
  const d = await res.json();
  document.getElementById('sysOS').textContent = d.os || '‚Äî';
  document.getElementById('sysCPU').textContent = (d.processor || '‚Äî').substring(0, 30);
  document.getElementById('sysHost').textContent = d.hostname || '‚Äî';
  document.getElementById('sysDT').textContent = d.disk_total || '‚Äî';
  document.getElementById('sysDU').textContent = d.disk_used || '‚Äî';
  document.getElementById('sysDF').textContent = d.disk_free || '‚Äî';
  document.getElementById('sysBadge').textContent = d.os || '‚Äî';
  drawDonut(d.disk_pct || 0, d.disk_free, d.disk_used, d.disk_total);
}

function drawDonut(pct, free, used, total) {
  const c = document.getElementById('diskChart');
  const ctx = c.getContext('2d');
  c.width = 110; c.height = 110;
  const cx = 55, cy = 55, r = 44, lw = 11;

  ctx.beginPath(); ctx.arc(cx, cy, r, 0, Math.PI*2);
  ctx.strokeStyle = '#1a2535'; ctx.lineWidth = lw; ctx.stroke();

  if (pct > 0) {
    const g = ctx.createLinearGradient(0, 0, 110, 0);
    g.addColorStop(0, '#00c8f0'); g.addColorStop(1, '#ff6b35');
    ctx.beginPath();
    ctx.arc(cx, cy, r, -Math.PI/2, -Math.PI/2 + (pct/100)*Math.PI*2);
    ctx.strokeStyle = g; ctx.lineWidth = lw; ctx.lineCap = 'round'; ctx.stroke();
  }

  ctx.fillStyle = '#c0d0e0';
  ctx.font = 'bold 15px Orbitron, monospace';
  ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
  ctx.fillText(pct + '%', cx, cy);

  document.getElementById('diskLegend').innerHTML = `
    <div class="leg-row"><div class="leg-dot" style="background:#1a2535;border:1px solid #243040"></div><div class="leg-lbl">Szabad</div><div class="leg-val">${free || '‚Äî'}</div></div>
    <div class="leg-row"><div class="leg-dot" style="background:linear-gradient(90deg,#00c8f0,#ff6b35)"></div><div class="leg-lbl">Haszn√°lt</div><div class="leg-val">${used || '‚Äî'}</div></div>
    <div class="leg-row"><div class="leg-dot" style="background:var(--border2)"></div><div class="leg-lbl">√ñsszesen</div><div class="leg-val">${total || '‚Äî'}</div></div>
  `;
}

// ---- HISTORY ----
async function loadHistory() {
  const res = await fetch('/api/history');
  const data = await res.json();
  document.getElementById('navHist').textContent = data.length;

  if (!data.length) {
    document.getElementById('historyContent').innerHTML = '<div style="color:var(--text2);font-size:12px;padding:20px">M√©g nincs el≈ëzm√©ny. Futtass egy tiszt√≠t√°st!</div>';
    return;
  }

  let totalSaved = 0;
  let html = '';
  data.forEach(e => {
    totalSaved += e.total_freed_bytes || 0;
    html += `
      <div class="history-item">
        <div>
          <div class="hist-ts">${e.timestamp}</div>
          <div class="hist-cats">${e.categories ? e.categories.join(', ') : '‚Äî'}</div>
        </div>
        <div><div class="hist-freed">${e.total_freed}</div></div>
        <div><div class="hist-files" style="color:var(--accent)">${e.total_files} f√°jl</div>
             <div class="hist-files">${e.total_errors} hiba</div></div>
      </div>`;
  });

  // Summary card
  const summaryHtml = `
    <div class="grid-3" style="margin-bottom:16px">
      <div class="card"><div class="card-hdr"><span class="card-lbl">√ñsszes tiszt√≠t√°s</span><span class="card-ico">üßπ</span></div>
        <div class="stat">${data.length}</div></div>
      <div class="card"><div class="card-hdr"><span class="card-lbl">√ñsszes felszabad√≠tva</span><span class="card-ico">üíæ</span></div>
        <div class="stat" style="color:var(--accent3)">${fmtB(totalSaved)}</div></div>
      <div class="card"><div class="card-hdr"><span class="card-lbl">Utols√≥ tiszt√≠t√°s</span><span class="card-ico">üïê</span></div>
        <div class="stat" style="font-size:12px">${data[0]?.timestamp || '‚Äî'}</div></div>
    </div>`;

  document.getElementById('historyContent').innerHTML = summaryHtml + html;
}

async function clearHistory() {
  if (!confirm('T√∂rl√∂d az √∂sszes el≈ëzm√©nyt?')) return;
  await fetch('/api/history/clear', {method:'POST'});
  loadHistory();
  addLog('El≈ëzm√©nyek t√∂r√∂lve', 'warn');
}

// ---- UTILS ----
function fmtB(n) {
  if (!n) return '0 B';
  if (n < 1024) return n + ' B';
  if (n < 1024**2) return (n/1024).toFixed(1) + ' KB';
  if (n < 1024**3) return (n/1024**2).toFixed(1) + ' MB';
  return (n/1024**3).toFixed(2) + ' GB';
}

// Set default large files path
document.getElementById('lfPath').value = navigator.platform.includes('Win') ? 
  'C:\\Users\\' + (document.title || 'user') : '~';

// Init
loadSysInfo();
</script>
</body>
</html>
